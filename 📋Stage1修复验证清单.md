# 📋 Stage1修复验证清单

> **修复提交**: `10f8cf7`  
> **修复日期**: 2026-01-19  
> **修复内容**: 产品数据加载 + 拖拽UI增强

---

## 🔧 修复内容

### 1️⃣ 产品数据加载修复
**问题**: 产品列表不显示  
**原因**: products数据被加载到了错误的Store（assetStore而非productStore）  
**修复**: 
- ✅ initializer.ts: 添加useProductStore导入
- ✅ loadProductsToStore函数: assetStore → productStore
- ✅ PIPlanningStage1.vue: 添加诊断日志

### 2️⃣ 拖拽UI增强
**问题**: 拖拽体验不明显  
**修复**:
- ✅ 待分配卡片: cursor改为move，hover/active效果增强
- ✅ 放置目标: 添加"📥 拖放到此处"提示文字和发光效果

---

## ✅ 验证步骤

### 第一步：刷新页面并检查Console

**1. 打开页面**:
```
http://localhost:6060/function/c3/planning/pi/PI-001/stage1
```

**2. 打开Console（F12），应该看到**:

#### ✅ 预期日志A：产品数据加载
```
✓ 加载了 11 个产品
```

#### ✅ 预期日志B：产品分组信息
```
🔍 Products: {
  count: 11,
  products: [
    { id: 'prod-001', name: 'ADAS核心算法', line: '智能驾驶' },
    { id: 'prod-002', name: '感知算法', line: '智能驾驶' },
    { id: 'prod-005', name: '语音交互系统', line: '智能座舱' }
  ]
}
```

#### ✅ 预期日志C：产品线分组
```
🔍 ProductsByLine: {
  lineCount: 3,
  lines: ['智能驾驶', '智能座舱', '电子电器'],
  totalProducts: 11
}
```

#### ✅ 预期日志D：数据加载完成
```
✅ Stage1 数据加载完成: {
  productsCount: 11,
  featuresCount: 29,
  sstsCount: 59,
  sprintsCount: 6
}
```

**❌ 如果没有看到这些日志**:
- 检查是否硬刷新（Ctrl+Shift+R / Cmd+Shift+R）
- 检查代码是否已拉取最新
- 检查构建是否成功

---

### 第二步：验证产品列表显示

**右侧看板应该显示**:

#### ✅ 表头
```
┌──────┬─────────┬─────────┬─────────┬─────────┐
│ 产品 │Sprint-1 │Sprint-2 │Sprint-3 │Sprint-4 │
└──────┴─────────┴─────────┴─────────┴─────────┘
```

#### ✅ 产品线1：智能驾驶（蓝色分隔条）
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔵 智能驾驶
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

下方应该显示6个产品行：
1. ADAS核心算法 (PROD-001)
2. 感知算法 (PROD-002)
3. 决策规划算法 (PROD-003)
4. 泊车算法 (PROD-004)
5. 地图服务 (PROD-009)
6. V2X系统 (PROD-011)

#### ✅ 产品线2：智能座舱（蓝色分隔条）
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔵 智能座舱
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

下方应该显示3个产品行：
1. 语音交互系统 (PROD-005)
2. AR-HUD系统 (PROD-006)
3. 多模交互 (PROD-007)

#### ✅ 产品线3：电子电器（蓝色分隔条）
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔵 电子电器
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

下方应该显示2个产品行：
1. 中央计算平台 (PROD-008)
2. OTA平台 (PROD-010)

**❌ 如果产品列表为空**:
1. 检查Console是否有`🔍 Products: { count: 11 }`日志
2. 检查Console是否有`🔍 ProductsByLine: { lineCount: 3 }`日志
3. 如果count为0，说明productStore.products为空，需要检查initializer
4. 截图Console日志并反馈

---

### 第三步：验证拖拽功能

#### 测试1：鼠标悬停效果

**操作**: 鼠标移到左侧待分配列表的任一Feature或SSTS卡片上

**预期效果**:
- ✅ 光标变为 ✋ (move/grab)
- ✅ 卡片上移2px
- ✅ 卡片出现蓝色阴影
- ✅ 卡片边框变为蓝色

#### 测试2：拖拽Feature

**操作**: 拖拽一个Feature（如FEAT-001）到任一产品×Sprint单元格

**预期效果**:

**1. 拖拽开始**:
- ✅ 光标变为 ✊ (grabbing)
- ✅ 卡片变为半透明（opacity: 0.7）

**2. 悬停在Sprint单元格上方**:
- ✅ 单元格显示绿色虚线边框
- ✅ 单元格显示"📥 拖放到此处"提示文字
- ✅ 单元格背景变为浅绿色

**3. 松开鼠标（放置）**:
- ✅ 提示消息："Feature及其N个SSTS已分配到[产品名] - [Sprint名]"
- ✅ Feature卡片出现在该单元格中
- ✅ Feature卡片左侧有▶图标

#### 测试3：Feature展开/收缩

**操作**: 点击刚分配的Feature卡片（或点击▶图标）

**预期效果**:

**展开时**:
- ✅ ▶图标旋转90度变为▼
- ✅ Feature卡片背景变为浅蓝色
- ✅ Feature卡片下方显示SSTS列表
- ✅ 每个SSTS显示编号、标题、SP值

**收缩时**:
- ✅ ▼图标旋转回0度变为▶
- ✅ Feature卡片背景恢复白色
- ✅ SSTS列表隐藏

#### 测试4：拖拽SSTS

**操作**: 拖拽一个SSTS（如SSTS-011）到任一产品×Sprint单元格

**预期效果**:
- ✅ 提示消息："SSTS已分配"
- ✅ 该SSTS所属的Feature自动出现在同一单元格
- ✅ 展开Feature，可以看到该SSTS在列表中

#### 测试5：移除Feature

**操作**: 点击Feature卡片右上角的×按钮

**预期效果**:
- ✅ 提示消息："Feature及其N个SSTS已移除"
- ✅ Feature卡片消失
- ✅ 该Feature的所有SSTS也一起消失

---

## 📊 完整测试矩阵

| 测试项 | 操作 | 预期结果 | 通过 |
|--------|------|----------|------|
| Console日志 | 刷新页面 | 看到4组诊断日志 | [ ] |
| 产品线分组 | 查看看板 | 看到3条蓝色分隔线 | [ ] |
| 产品列表 | 查看看板 | 看到11个产品行 | [ ] |
| 拖拽提示 | 悬停卡片 | 光标变为move | [ ] |
| 拖拽效果 | 拖动卡片 | 光标变为grabbing | [ ] |
| 放置提示 | 悬停单元格 | 显示绿色边框+提示文字 | [ ] |
| Feature分配 | 拖放Feature | Feature和SSTS一起分配 | [ ] |
| Feature展开 | 点击Feature | 显示SSTS列表 | [ ] |
| Feature收缩 | 再次点击 | 隐藏SSTS列表 | [ ] |
| SSTS分配 | 拖放SSTS | SSTS和Feature一起分配 | [ ] |
| Feature移除 | 点击×按钮 | Feature和SSTS一起移除 | [ ] |

---

## 🐛 常见问题

### Q1: 产品列表为空
**诊断**:
1. 检查Console是否有`✓ 加载了 11 个产品`日志
2. 检查Console是否有`🔍 Products: { count: 11 }`日志
3. 如果count为0，说明productStore未正确加载

**解决**:
```bash
# 清除缓存并重新构建
rm -rf node_modules/.vite
npm run dev
```

### Q2: 产品线分隔不显示
**诊断**:
1. 检查Console `🔍 ProductsByLine`日志
2. 检查lineCount是否为3

**解决**:
- 检查products.json中每个产品是否有`productLine`字段

### Q3: 无法拖拽
**诊断**:
1. 检查左侧卡片是否有`draggable="true"`属性（F12审查元素）
2. 检查鼠标悬停时光标是否变为move

**解决**:
- 硬刷新页面（Ctrl+Shift+R）
- 检查浏览器是否禁用了拖拽功能

### Q4: 拖拽后没有反应
**诊断**:
1. 检查Console是否有错误日志
2. 检查是否显示了成功提示消息

**解决**:
- 检查`handleDrop`函数是否正常执行
- 查看Console日志，定位具体报错

---

## 📸 截图示例

### 正确显示的效果

#### 产品列表
```
┌──────────────────┬─────────┬─────────┬─────────┐
│ 产品             │Sprint-1 │Sprint-2 │Sprint-3 │
├──────────────────┼─────────┼─────────┼─────────┤
│ 【智能驾驶】                                    │
├──────────────────┼─────────┼─────────┼─────────┤
│ ADAS核心算法     │         │         │         │
│ PROD-001         │         │         │         │
├──────────────────┼─────────┼─────────┼─────────┤
│ 感知算法         │         │         │         │
│ PROD-002         │         │         │         │
├──────────────────┼─────────┼─────────┼─────────┤
│ ...              │         │         │         │
└──────────────────┴─────────┴─────────┴─────────┘
```

#### Feature展开效果
```
┌─────────────────────────────┐
│ ▼ FEAT-001                 × │ ← 已展开
│ ACC自适应巡航控制            │
│ 20 SP | 3 个SSTS            │
│ ┌───────────────────────┐   │
│ │ SSTS-001 | 5 SP       │   │
│ │ ACC控制逻辑            │   │
│ ├───────────────────────┤   │
│ │ SSTS-002 | 8 SP       │   │
│ │ 目标识别与跟踪         │   │
│ ├───────────────────────┤   │
│ │ SSTS-003 | 7 SP       │   │
│ │ 速度控制与制动         │   │
│ └───────────────────────┘   │
└─────────────────────────────┘
```

---

## 📞 问题反馈

**如果验证失败，请提供**:
1. **Console完整日志**（特别是🔍和✅开头的日志）
2. **截图**（产品看板区域）
3. **具体问题描述**（哪一步失败了）

**预期返回格式**:
```
❌ 验证失败：产品列表为空

Console日志：
✓ 加载了 11 个产品
🔍 Products: { count: 0, products: [] }  ← 这里count为0！

截图：[附上看板截图]

问题：productStore.products为空，数据未正确加载
```

---

**END OF DOCUMENT**
