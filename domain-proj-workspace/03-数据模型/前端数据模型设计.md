# 前端数据模型设计

> **文档版本**: V1.0  
> **创建时间**: 2026-01-20  
> **设计说明**: 前端TypeScript接口定义、Pinia Store设计、数据关系

---

## 一、前端技术栈

### 1.1 技术选型
- **框架**: Vue 3 + TypeScript
- **状态管理**: Pinia
- **UI组件**: Element Plus
- **路由**: Vue Router
- **日期处理**: dayjs
- **HTTP客户端**: axios

### 1.2 数据层架构
```
┌─────────────────────────────────────┐
│           Vue组件层                  │
│  (页面组件、业务组件、UI组件)         │
└─────────────┬───────────────────────┘
              │ 使用Store
┌─────────────▼───────────────────────┐
│         Pinia Store层                │
│  (状态管理、业务逻辑、数据缓存)       │
└─────────────┬───────────────────────┘
              │ 调用API
┌─────────────▼───────────────────────┐
│          API Service层               │
│  (HTTP请求封装、数据转换)             │
└─────────────┬───────────────────────┘
              │ Mock/真实API
┌─────────────▼───────────────────────┐
│         Mock数据/后端API             │
└─────────────────────────────────────┘
```

---

## 二、TypeScript接口定义

### 2.1 整车项目 (VehicleProject)

```typescript
// ============================================
// 整车项目相关类型定义
// ============================================

/**
 * 车型类型
 */
export enum VehicleModel {
  SEDAN = 'sedan',           // 轿车
  SUV = 'suv',               // SUV
  MPV = 'mpv',               // MPV
  PICKUP = 'pickup'          // 皮卡
}

/**
 * 产品线
 */
export enum ProductLine {
  ADAS = 'adas',             // 智能驾驶
  CABIN = 'cabin',           // 智能座舱
  EEA = 'eea',               // 电子电器架构
  CHASSIS = 'chassis',       // 底盘控制
  POWER = 'power'            // 动力系统
}

/**
 * 项目状态
 */
export enum ProjectStatus {
  PLANNING = 'planning',     // 规划中
  ACTIVE = 'active',         // 执行中
  ON_HOLD = 'on_hold',       // 暂停
  COMPLETED = 'completed',   // 已完成
  CANCELLED = 'cancelled'    // 已取消
}

/**
 * 健康度状态
 */
export enum HealthStatus {
  GREEN = 'green',           // 健康
  YELLOW = 'yellow',         // 风险
  RED = 'red'                // 严重问题
}

/**
 * 用户信息
 */
export interface User {
  userId: string
  userName: string
  userEmail: string
  userRole: string[]
  avatar?: string
}

/**
 * 整车项目
 */
export interface VehicleProject {
  // 基本信息
  projectId: string
  projectName: string
  projectCode: string
  projectDescription: string
  
  // 车型信息
  vehicleModel: VehicleModel
  vehiclePlatform?: string
  
  // 产品线
  productLines: ProductLine[]
  
  // 时间规划
  startDate: string          // ISO 8601格式
  endDate: string
  duration: number           // 周数
  
  // PI规划
  piCycle: number            // PI周期（周）
  piCount: number            // PI总数
  currentPIId?: string       // 当前PI ID
  
  // 管理信息
  projectManager: User
  productOwner: User
  architect: User
  qualityLead?: User
  stakeholders: User[]
  
  // 统计信息
  stats: {
    totalEpics: number
    totalFeatures: number
    totalVersions: number
    totalPIs: number
    totalMilestones: number
    completedMilestones: number
  }
  
  // 状态
  status: ProjectStatus
  health: HealthStatus
  
  // 元数据
  createdAt: string
  updatedAt: string
  createdBy: string
}

/**
 * 项目列表项（简化版，用于列表展示）
 */
export interface ProjectListItem {
  projectId: string
  projectName: string
  projectCode: string
  vehicleModel: VehicleModel
  status: ProjectStatus
  health: HealthStatus
  progress: number           // 0-100
  startDate: string
  endDate: string
  projectManager: User
}

/**
 * 项目创建/编辑表单
 */
export interface ProjectFormData {
  projectName: string
  projectCode: string
  projectDescription: string
  vehicleModel: VehicleModel
  vehiclePlatform?: string
  productLines: ProductLine[]
  startDate: string
  endDate: string
  piCycle: number
  piCount: number
  projectManagerId: string
  productOwnerId: string
  architectId: string
  qualityLeadId?: string
  stakeholderIds: string[]
}
```

---

### 2.2 车型里程碑 (Milestone)

```typescript
// ============================================
// 车型里程碑相关类型定义
// ============================================

/**
 * 里程碑类型
 */
export enum MilestoneType {
  // 车辆交付类
  SAMPLE_VEHICLE = 'sample_vehicle',
  ENGINEERING_VEHICLE = 'engineering_vehicle',
  PP_VEHICLE = 'pp_vehicle',
  PV_VEHICLE = 'pv_vehicle',
  SOP = 'sop',
  
  // 功能冻结类
  FUNCTION_FREEZE = 'function_freeze',
  FEATURE_COMPLETE = 'feature_complete',
  
  // 代码冻结类
  CODE_FREEZE = 'code_freeze',
  BASELINE_LOCK = 'baseline_lock',
  
  // 版本发布类
  VERSION_RELEASE = 'version_release',
  OTA_RELEASE = 'ota_release',
  
  // 认证类
  SAFETY_CERT = 'safety_cert',
  COMPLIANCE_CERT = 'compliance_cert'
}

/**
 * 里程碑状态
 */
export enum MilestoneStatus {
  NOT_STARTED = 'not_started',
  IN_PROGRESS = 'in_progress',
  AT_RISK = 'at_risk',
  COMPLETED = 'completed',
  DELAYED = 'delayed'
}

/**
 * 交付物类型
 */
export enum DeliverableType {
  SOFTWARE = 'software',
  DOCUMENT = 'document',
  TEST_REPORT = 'test_report',
  CERTIFICATION = 'certification'
}

/**
 * 交付物状态
 */
export enum DeliverableStatus {
  NOT_STARTED = 'not_started',
  IN_PROGRESS = 'in_progress',
  COMPLETED = 'completed'
}

/**
 * 交付物
 */
export interface Deliverable {
  deliverableId: string
  name: string
  type: DeliverableType
  description: string
  status: DeliverableStatus
  owner: User
  dueDate?: string
}

/**
 * 车型里程碑
 */
export interface Milestone {
  milestoneId: string
  milestoneName: string
  milestoneType: MilestoneType
  description: string
  
  projectId: string
  
  targetDate: string
  actualDate?: string
  
  deliverables: Deliverable[]
  requirements: string[]
  
  linkedVersionId?: string
  linkedPIId?: string
  dependencies: string[]      // 依赖的其他里程碑ID
  
  status: MilestoneStatus
  completionRate: number      // 0-100
  
  createdAt: string
  updatedAt: string
}

/**
 * 里程碑表单
 */
export interface MilestoneFormData {
  milestoneName: string
  milestoneType: MilestoneType
  description: string
  targetDate: string
  requirements: string[]
  linkedVersionId?: string
  linkedPIId?: string
  dependencies: string[]
}
```

---

### 2.3 产品版本 (Version)

```typescript
// ============================================
// 产品版本相关类型定义
// ============================================

/**
 * 版本类型
 */
export enum VersionType {
  MAJOR = 'major',
  MINOR = 'minor',
  PATCH = 'patch',
  HOTFIX = 'hotfix'
}

/**
 * 版本状态
 */
export enum VersionStatus {
  PLANNING = 'planning',
  DEVELOPMENT = 'development',
  TESTING = 'testing',
  RELEASED = 'released',
  DEPRECATED = 'deprecated'
}

/**
 * 分配状态
 */
export enum AllocationStatus {
  PLANNED = 'planned',
  IN_PROGRESS = 'in_progress',
  COMPLETED = 'completed',
  DELAYED = 'delayed'
}

/**
 * 优先级
 */
export enum Priority {
  P0 = 'P0',
  P1 = 'P1',
  P2 = 'P2',
  P3 = 'P3'
}

/**
 * Feature分配（含完成度）⭐核心创新
 */
export interface FeatureAllocation {
  featureId: string
  featureName: string
  priority: Priority
  
  totalStoryPoints: number
  completionTarget: number    // 完成度目标：0-100%
  targetStoryPoints: number   // 目标SP = 总SP × 完成度
  
  status: AllocationStatus
  actualProgress: number      // 实际完成度
  
  sstss: string[]            // 关联SSTS ID
}

/**
 * Epic分配（含完成度）⭐核心创新
 */
export interface EpicAllocation {
  allocationId: string
  epicId: string
  epicName: string
  epicPriority: Priority
  
  totalStoryPoints: number
  completionTarget: number    // 完成度目标：0-100%
  targetStoryPoints: number   // 目标SP = 总SP × 完成度
  
  features: FeatureAllocation[]
  selectedFeatureCount: number
  
  status: AllocationStatus
  actualProgress: number
  
  createdAt: string
}

/**
 * 版本范围
 */
export interface VersionScope {
  epics: EpicAllocation[]
  
  totalEpics: number
  totalFeatures: number
  totalStoryPoints: number
  
  completionTarget: number    // 整体完成度目标
}

/**
 * 版本进度
 */
export interface VersionProgress {
  overallProgress: number
  
  completedEpics: number
  totalEpics: number
  epicProgress: number
  
  completedFeatures: number
  totalFeatures: number
  featureProgress: number
  
  completedStoryPoints: number
  targetStoryPoints: number
  storyPointProgress: number
}

/**
 * 产品版本
 */
export interface Version {
  versionId: string
  versionNumber: string
  versionName: string
  versionType: VersionType
  description: string
  
  projectId: string
  
  targetDate: string
  actualDate?: string
  
  linkedMilestoneId?: string
  
  scope: VersionScope
  
  owner: User
  status: VersionStatus
  
  progress: VersionProgress
  
  createdAt: string
  updatedAt: string
}

/**
 * 版本表单
 */
export interface VersionFormData {
  versionNumber: string
  versionName: string
  versionType: VersionType
  description: string
  targetDate: string
  linkedMilestoneId?: string
  ownerId: string
  
  // Epic选择和完成度设置
  epicAllocations: {
    epicId: string
    completionTarget: number
    features?: {
      featureId: string
      completionTarget: number
    }[]
  }[]
}
```

---

### 2.4 PI规划 (PI)

```typescript
// ============================================
// PI相关类型定义
// ============================================

/**
 * PI状态
 */
export enum PIStatus {
  PLANNING = 'planning',
  READY = 'ready',
  ACTIVE = 'active',
  INSPECT_ADAPT = 'inspect_adapt',
  COMPLETED = 'completed'
}

/**
 * PI目标状态
 */
export enum ObjectiveStatus {
  PLANNED = 'planned',
  COMMITTED = 'committed',
  ACHIEVED = 'achieved',
  PARTIALLY_ACHIEVED = 'partially_achieved',
  NOT_ACHIEVED = 'not_achieved'
}

/**
 * 负载状态
 */
export enum LoadStatus {
  LOW = 'low',
  OPTIMAL = 'optimal',
  HIGH = 'high',
  OVERLOAD = 'overload'
}

/**
 * PI目标
 */
export interface PIObjective {
  objectiveId: string
  description: string
  businessValue: number       // 1-10分
  
  linkedEpics: string[]
  
  confidence: number          // 1-5分
  status: ObjectiveStatus
  actualValue?: number
  
  owner: User
  acceptanceCriteria: string[]
}

/**
 * 团队分配
 */
export interface TeamAllocation {
  teamId: string
  teamName: string
  domain: string
  
  capacity: number            // 容量：人天
  velocity: number            // 速率：SP/Sprint
  
  allocation: number          // 已分配：人天
  storyPoints: number         // 分配SP
  loadRate: number            // 负载率：0-100
  loadStatus: LoadStatus
  
  assignedFeatures: string[]
  assignedSSTSs: string[]
}

/**
 * PI范围
 */
export interface PIScope {
  epics: string[]
  features: string[]
  sstss: string[]
  
  totalStoryPoints: number
  allocatedStoryPoints: number
  
  teamAllocations: TeamAllocation[]
}

/**
 * 团队进度
 */
export interface TeamProgress {
  teamId: string
  teamName: string
  progress: number
  velocity: number
  loadRate: number
}

/**
 * PI进度
 */
export interface PIProgress {
  overallProgress: number
  completedSprints: number
  totalSprints: number
  
  completedObjectives: number
  totalObjectives: number
  objectiveProgress: number
  
  completedStoryPoints: number
  totalStoryPoints: number
  storyPointProgress: number
  
  teamProgress: TeamProgress[]
}

/**
 * PI
 */
export interface PI {
  piId: string
  piNumber: string
  piName: string
  description: string
  
  projectId: string
  
  startDate: string
  endDate: string
  duration: number
  
  sprintCount: number
  sprintDuration: number
  
  linkedVersionId?: string
  linkedMilestoneId?: string
  previousPIId?: string
  nextPIId?: string
  
  objectives: PIObjective[]
  scope: PIScope
  
  status: PIStatus
  progress: PIProgress
  
  createdAt: string
  updatedAt: string
}

/**
 * PI表单
 */
export interface PIFormData {
  piNumber: string
  piName: string
  description: string
  startDate: string
  endDate: string
  duration: number
  sprintCount: number
  linkedVersionId?: string
  linkedMilestoneId?: string
  
  objectives: {
    description: string
    businessValue: number
    linkedEpics: string[]
    confidence: number
  }[]
  
  epicAllocations: {
    epicId: string
    completion: number
    teamId: string
  }[]
}
```

---

## 三、Pinia Store设计

### 3.1 项目Store (useProjectStore)

```typescript
// stores/modules/project.ts
import { defineStore } from 'pinia'
import type { VehicleProject, ProjectListItem, ProjectFormData } from '@/types/project'
import * as projectApi from '@/api/project'

export const useProjectStore = defineStore('project', {
  state: () => ({
    // 项目列表
    projectList: [] as ProjectListItem[],
    
    // 当前项目
    currentProject: null as VehicleProject | null,
    
    // 加载状态
    loading: false,
    
    // 列表过滤器
    filters: {
      status: [] as string[],
      vehicleModel: [] as string[],
      searchText: ''
    }
  }),
  
  getters: {
    /**
     * 过滤后的项目列表
     */
    filteredProjects(): ProjectListItem[] {
      let result = this.projectList
      
      // 按状态过滤
      if (this.filters.status.length > 0) {
        result = result.filter(p => this.filters.status.includes(p.status))
      }
      
      // 按车型过滤
      if (this.filters.vehicleModel.length > 0) {
        result = result.filter(p => this.filters.vehicleModel.includes(p.vehicleModel))
      }
      
      // 按搜索文本过滤
      if (this.filters.searchText) {
        const text = this.filters.searchText.toLowerCase()
        result = result.filter(p => 
          p.projectName.toLowerCase().includes(text) ||
          p.projectCode.toLowerCase().includes(text)
        )
      }
      
      return result
    },
    
    /**
     * 当前项目的PI列表
     */
    currentProjectPIs() {
      if (!this.currentProject) return []
      // 会从piStore获取
      return []
    }
  },
  
  actions: {
    /**
     * 加载项目列表
     */
    async fetchProjectList() {
      this.loading = true
      try {
        const data = await projectApi.getProjectList()
        this.projectList = data
        console.log(`✓ 加载了 ${data.length} 个项目`)
      } catch (error) {
        console.error('加载项目列表失败', error)
        throw error
      } finally {
        this.loading = false
      }
    },
    
    /**
     * 加载项目详情
     */
    async fetchProjectById(projectId: string) {
      this.loading = true
      try {
        const data = await projectApi.getProjectById(projectId)
        this.currentProject = data
        console.log(`✓ 加载项目: ${data.projectName}`)
        return data
      } catch (error) {
        console.error('加载项目详情失败', error)
        throw error
      } finally {
        this.loading = false
      }
    },
    
    /**
     * 创建项目
     */
    async createProject(formData: ProjectFormData) {
      this.loading = true
      try {
        const project = await projectApi.createProject(formData)
        this.projectList.unshift(project as ProjectListItem)
        console.log(`✓ 创建项目成功: ${project.projectId}`)
        return project
      } catch (error) {
        console.error('创建项目失败', error)
        throw error
      } finally {
        this.loading = false
      }
    },
    
    /**
     * 更新项目
     */
    async updateProject(projectId: string, formData: Partial<ProjectFormData>) {
      this.loading = true
      try {
        const project = await projectApi.updateProject(projectId, formData)
        // 更新列表
        const index = this.projectList.findIndex(p => p.projectId === projectId)
        if (index !== -1) {
          this.projectList[index] = project as ProjectListItem
        }
        // 更新当前项目
        if (this.currentProject?.projectId === projectId) {
          this.currentProject = project
        }
        console.log(`✓ 更新项目成功: ${projectId}`)
        return project
      } catch (error) {
        console.error('更新项目失败', error)
        throw error
      } finally {
        this.loading = false
      }
    },
    
    /**
     * 设置过滤器
     */
    setFilters(filters: Partial<typeof this.filters>) {
      Object.assign(this.filters, filters)
    },
    
    /**
     * 清除过滤器
     */
    clearFilters() {
      this.filters = {
        status: [],
        vehicleModel: [],
        searchText: ''
      }
    }
  }
})
```

---

### 3.2 版本Store (useVersionStore)

```typescript
// stores/modules/version.ts
import { defineStore } from 'pinia'
import type { Version, VersionFormData } from '@/types/version'
import * as versionApi from '@/api/version'

export const useVersionStore = defineStore('version', {
  state: () => ({
    versions: [] as Version[],
    currentVersion: null as Version | null,
    loading: false
  }),
  
  getters: {
    /**
     * 按项目ID获取版本列表
     */
    getVersionsByProjectId: (state) => (projectId: string) => {
      return state.versions.filter(v => v.projectId === projectId)
    },
    
    /**
     * 按状态分组的版本
     */
    versionsByStatus() {
      const grouped: Record<string, Version[]> = {}
      this.versions.forEach(version => {
        if (!grouped[version.status]) {
          grouped[version.status] = []
        }
        grouped[version.status].push(version)
      })
      return grouped
    }
  },
  
  actions: {
    /**
     * 加载项目的版本列表
     */
    async fetchVersionsByProject(projectId: string) {
      this.loading = true
      try {
        const data = await versionApi.getVersionsByProject(projectId)
        // 合并到versions，避免重复
        data.forEach(version => {
          const index = this.versions.findIndex(v => v.versionId === version.versionId)
          if (index === -1) {
            this.versions.push(version)
          } else {
            this.versions[index] = version
          }
        })
        console.log(`✓ 加载了 ${data.length} 个版本`)
        return data
      } catch (error) {
        console.error('加载版本列表失败', error)
        throw error
      } finally {
        this.loading = false
      }
    },
    
    /**
     * 加载版本详情
     */
    async fetchVersionById(versionId: string) {
      this.loading = true
      try {
        const data = await versionApi.getVersionById(versionId)
        this.currentVersion = data
        
        // 更新缓存
        const index = this.versions.findIndex(v => v.versionId === versionId)
        if (index === -1) {
          this.versions.push(data)
        } else {
          this.versions[index] = data
        }
        
        console.log(`✓ 加载版本: ${data.versionName}`)
        return data
      } catch (error) {
        console.error('加载版本详情失败', error)
        throw error
      } finally {
        this.loading = false
      }
    },
    
    /**
     * 创建版本（含完成度设置）⭐核心
     */
    async createVersion(formData: VersionFormData) {
      this.loading = true
      try {
        const version = await versionApi.createVersion(formData)
        this.versions.unshift(version)
        console.log(`✓ 创建版本成功: ${version.versionNumber}`)
        return version
      } catch (error) {
        console.error('创建版本失败', error)
        throw error
      } finally {
        this.loading = false
      }
    },
    
    /**
     * 更新Epic完成度⭐核心
     */
    async updateEpicCompletion(
      versionId: string,
      epicId: string,
      completionTarget: number,
      features?: { featureId: string, completionTarget: number }[]
    ) {
      this.loading = true
      try {
        const version = await versionApi.updateEpicCompletion(
          versionId,
          epicId,
          completionTarget,
          features
        )
        
        // 更新缓存
        const index = this.versions.findIndex(v => v.versionId === versionId)
        if (index !== -1) {
          this.versions[index] = version
        }
        
        if (this.currentVersion?.versionId === versionId) {
          this.currentVersion = version
        }
        
        console.log(`✓ 更新Epic完成度: ${epicId} → ${completionTarget}%`)
        return version
      } catch (error) {
        console.error('更新Epic完成度失败', error)
        throw error
      } finally {
        this.loading = false
      }
    }
  }
})
```

---

### 3.3 PI Store (usePIStore)

```typescript
// stores/modules/pi.ts
import { defineStore } from 'pinia'
import type { PI, PIFormData } from '@/types/pi'
import * as piApi from '@/api/pi'

export const usePIStore = defineStore('pi', {
  state: () => ({
    pis: [] as PI[],
    currentPI: null as PI | null,
    loading: false
  }),
  
  getters: {
    /**
     * 按项目ID获取PI列表
     */
    getPIsByProjectId: (state) => (projectId: string) => {
      return state.pis
        .filter(pi => pi.projectId === projectId)
        .sort((a, b) => a.piNumber.localeCompare(b.piNumber))
    },
    
    /**
     * 获取活动的PI
     */
    activePI(): PI | null {
      return this.pis.find(pi => pi.status === 'ACTIVE') || null
    }
  },
  
  actions: {
    /**
     * 加载项目的PI列表
     */
    async fetchPIsByProject(projectId: string) {
      this.loading = true
      try {
        const data = await piApi.getPIsByProject(projectId)
        data.forEach(pi => {
          const index = this.pis.findIndex(p => p.piId === pi.piId)
          if (index === -1) {
            this.pis.push(pi)
          } else {
            this.pis[index] = pi
          }
        })
        console.log(`✓ 加载了 ${data.length} 个PI`)
        return data
      } catch (error) {
        console.error('加载PI列表失败', error)
        throw error
      } finally {
        this.loading = false
      }
    },
    
    /**
     * 创建PI（含里程碑映射）⭐核心
     */
    async createPI(formData: PIFormData) {
      this.loading = true
      try {
        const pi = await piApi.createPI(formData)
        this.pis.unshift(pi)
        console.log(`✓ 创建PI成功: ${pi.piNumber}`)
        return pi
      } catch (error) {
        console.error('创建PI失败', error)
        throw error
      } finally {
        this.loading = false
      }
    },
    
    /**
     * 检查里程碑对齐⭐核心
     */
    checkMilestoneAlignment(piEndDate: string, milestones: any[]) {
      // 里程碑对齐算法
      return milestones.map(milestone => {
        const daysDiff = dayjs(milestone.targetDate).diff(piEndDate, 'day')
        
        let alignmentLevel: 'PERFECT' | 'ACCEPTABLE' | 'MISALIGNED'
        if (Math.abs(daysDiff) <= 7) {
          alignmentLevel = 'PERFECT'
        } else if (Math.abs(daysDiff) <= 14) {
          alignmentLevel = 'ACCEPTABLE'
        } else {
          alignmentLevel = 'MISALIGNED'
        }
        
        return {
          milestone,
          daysDiff,
          alignmentLevel
        }
      })
    }
  }
})
```

---

### 3.4 里程碑Store (useMilestoneStore)

```typescript
// stores/modules/milestone.ts
import { defineStore } from 'pinia'
import type { Milestone, MilestoneFormData } from '@/types/milestone'
import * as milestoneApi from '@/api/milestone'

export const useMilestoneStore = defineStore('milestone', {
  state: () => ({
    milestones: [] as Milestone[],
    loading: false
  }),
  
  getters: {
    /**
     * 按项目ID获取里程碑
     */
    getMilestonesByProjectId: (state) => (projectId: string) => {
      return state.milestones
        .filter(m => m.projectId === projectId)
        .sort((a, b) => a.targetDate.localeCompare(b.targetDate))
    },
    
    /**
     * 按类型分组
     */
    milestonesByType() {
      const grouped: Record<string, Milestone[]> = {}
      this.milestones.forEach(milestone => {
        if (!grouped[milestone.milestoneType]) {
          grouped[milestone.milestoneType] = []
        }
        grouped[milestone.milestoneType].push(milestone)
      })
      return grouped
    }
  },
  
  actions: {
    /**
     * 加载项目里程碑
     */
    async fetchMilestonesByProject(projectId: string) {
      this.loading = true
      try {
        const data = await milestoneApi.getMilestonesByProject(projectId)
        data.forEach(milestone => {
          const index = this.milestones.findIndex(m => m.milestoneId === milestone.milestoneId)
          if (index === -1) {
            this.milestones.push(milestone)
          } else {
            this.milestones[index] = milestone
          }
        })
        console.log(`✓ 加载了 ${data.length} 个里程碑`)
        return data
      } catch (error) {
        console.error('加载里程碑失败', error)
        throw error
      } finally {
        this.loading = false
      }
    },
    
    /**
     * 创建里程碑
     */
    async createMilestone(formData: MilestoneFormData) {
      this.loading = true
      try {
        const milestone = await milestoneApi.createMilestone(formData)
        this.milestones.push(milestone)
        console.log(`✓ 创建里程碑成功: ${milestone.milestoneName}`)
        return milestone
      } catch (error) {
        console.error('创建里程碑失败', error)
        throw error
      } finally {
        this.loading = false
      }
    }
  }
})
```

---

## 四、数据关系和级联更新

### 4.1 数据关系图

```typescript
/**
 * 数据关系：
 * 
 * Project (1) ─┬─> Milestones (N)
 *              ├─> Versions (N)
 *              └─> PIs (N)
 * 
 * Version (1) ─┬─> Milestone (1) [linkedMilestoneId]
 *              └─> EpicAllocations (N)
 * 
 * PI (1) ──────┬─> Version (1) [linkedVersionId]
 *              └─> Milestone (1) [linkedMilestoneId]
 * 
 * EpicAllocation (1) ─> FeatureAllocations (N)
 */
```

### 4.2 级联加载策略

```typescript
/**
 * 项目详情页加载策略
 */
export async function loadProjectDetailData(projectId: string) {
  const projectStore = useProjectStore()
  const versionStore = useVersionStore()
  const piStore = usePIStore()
  const milestoneStore = useMilestoneStore()
  
  // 并行加载所有数据
  await Promise.all([
    projectStore.fetchProjectById(projectId),
    versionStore.fetchVersionsByProject(projectId),
    piStore.fetchPIsByProject(projectId),
    milestoneStore.fetchMilestonesByProject(projectId)
  ])
}

/**
 * 版本详情页加载策略
 */
export async function loadVersionDetailData(versionId: string) {
  const versionStore = useVersionStore()
  const epicStore = useEpicStore()
  const featureStore = useFeatureStore()
  
  // 加载版本详情
  const version = await versionStore.fetchVersionById(versionId)
  
  // 加载关联的Epic和Feature
  const epicIds = version.scope.epics.map(e => e.epicId)
  await Promise.all([
    ...epicIds.map(id => epicStore.fetchEpicById(id))
  ])
}
```

---

**文档版本**: V1.0  
**创建时间**: 2026-01-20  
**最后更新**: 2026-01-20  
**维护人员**: 平台设计组
