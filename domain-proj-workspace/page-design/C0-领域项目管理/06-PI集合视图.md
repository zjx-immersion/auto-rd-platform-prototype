# C0-06: PI集合视图

> **页面标识**: C0-06  
> **优先级**: P1 ⭐⭐⭐⭐  
> **设计版本**: V3.0  
> **更新时间**: 2026-01-20

---

## 📋 页面概述

### 定位与价值

**页面定位**：查看和管理系统自动生成的PI集合，是1级视图的重要组成部分

**核心价值**：
1. ✅ **PI集合展示**：查看所有自动生成的PI
2. ✅ **版本汇总**：每个PI包含的产品版本一目了然
3. ✅ **范围可见**：Epic和Story Points统计
4. ✅ **快速跳转**：快速进入PI Planning工作台
5. ✅ **状态追踪**：PI的规划和执行状态

**核心理念**：
> PI不是手动创建的，而是基于版本规划自动生成的。PI = 同期交付的多个产品版本的集合。

---

## 🎯 功能需求

### 核心功能列表

| 功能模块 | 功能点 | 优先级 |
|---------|-------|--------|
| **PI列表展示** | 卡片式展示所有PI | P0 |
| **PI详情** | 查看PI包含的版本和Epic | P0 |
| **刷新PI集合** | 重新生成PI集合 | P0 |
| **进入PI Planning** | 跳转到PI Planning工作台 | P0 |
| **导出PI报告** | 导出PI范围报告 | P1 |
| **对齐状态**| 显示里程碑对齐状态 | P1 |
| **进度追踪** | 显示PI的执行进度 | P2 |

---

## 🖼️ 页面布局

### 整体布局结构

```
┌────────────────────────────────────────────────────────────────┐
│ 🎨 顶部导航栏                                                   │
│ ┌──────────────────────────────────────────────────────────┐   │
│ │ ◀ 返回项目Timeline    PI集合视图 - 岚图H56项目           │   │
│ │                                                           │   │
│ │ [🔄 刷新PI集合] [📊 导出汇总报告] [➡️ 返回版本规划]      │   │
│ └──────────────────────────────────────────────────────────┘   │
├────────────────────────────────────────────────────────────────┤
│                                                                 │
│ 💡 说明提示区                                                   │
│ ┌──────────────────────────────────────────────────────────┐   │
│ │ ℹ️ PI集合说明：                                           │   │
│ │ • PI由系统根据版本规划自动生成，与里程碑对齐             │   │
│ │ • 每个PI包含同期交付的多个产品版本                       │   │
│ │ • 如需调整PI，请返回版本规划工作台调整版本规划           │   │
│ │ • 点击"进入PI Planning"开始Feature细化                   │   │
│ └──────────────────────────────────────────────────────────┘   │
│                                                                 │
│ 📊 统计概览区                                                   │
│ ┌──────────────────────────────────────────────────────────┐   │
│ │ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐       │   │
│ │ │ 总PI数   │ │ 总版本   │ │ 总Epic  │ │ 总SP     │       │   │
│ │ │   3个   │ │   8个   │ │  15个  │ │ 1200    │       │   │
│ │ └─────────┘ └─────────┘ └─────────┘ └─────────┘       │   │
│ └──────────────────────────────────────────────────────────┘   │
│                                                                 │
│ 🎯 PI卡片列表区（主区域）                                       │
│ ┌──────────────────────────────────────────────────────────┐   │
│ │                                                           │   │
│ │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━       │   │
│ │ 🎯 PI-1：工程样车 PI (EP PI)                             │   │
│ │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━       │   │
│ │                                                           │   │
│ │ ⏱️ 时间范围                                              │   │
│ │ ┌─────────────────────────────────────────────────────┐ │   │
│ │ │ 开始：2025-02-01 | 结束：2025-04-25                 │ │   │
│ │ │ 迭代区间：迭代1-6                                    │ │   │
│ │ │ 周期：12周                                           │ │   │
│ │ └─────────────────────────────────────────────────────┘ │   │
│ │                                                           │   │
│ │ 🏁 里程碑对齐                                             │   │
│ │ ┌─────────────────────────────────────────────────────┐ │   │
│ │ │ 对齐里程碑：工程样车（EP）- 2025-06-30              │ │   │
│ │ │ Buffer：66天                                         │ │   │
│ │ │ 对齐状态：🟢 良好                                    │ │   │
│ │ └─────────────────────────────────────────────────────┘ │   │
│ │                                                           │   │
│ │ 📦 包含版本（3个）                                        │   │
│ │ ┌─────────────────────────────────────────────────────┐ │   │
│ │ │ • ADAS ECU V1.0        │ 80%  │ 80 SP  │ 迭代1-6 │ │   │
│ │ │ • 座舱HMI V1.0         │ 100% │ 80 SP  │ 迭代1-6 │ │   │
│ │ │ • 网关 V1.0            │ 100% │ 80 SP  │ 迭代3-8 │ │   │
│ │ └─────────────────────────────────────────────────────┘ │   │
│ │                                                           │   │
│ │ 🎯 Epic范围                                               │   │
│ │ ┌─────────────────────────────────────────────────────┐ │   │
│ │ │ Epic数量：5个                                        │ │   │
│ │ │ 总Story Points：240 SP                              │ │   │
│ │ │ 预估Feature：18个                                    │ │   │
│ │ └─────────────────────────────────────────────────────┘ │   │
│ │                                                           │   │
│ │ 📊 执行状态                                               │   │
│ │ ┌─────────────────────────────────────────────────────┐ │   │
│ │ │ 规划状态：✅ 已完成                                  │ │   │
│ │ │ PI Planning：⏳ 待开始                               │ │   │
│ │ │ 执行进度：0% (尚未开始)                              │ │   │
│ │ └─────────────────────────────────────────────────────┘ │   │
│ │                                                           │   │
│ │ 🔧 操作按钮                                               │   │
│ │ ┌─────────────────────────────────────────────────────┐ │   │
│ │ │ [👁️ 查看详情] [➡️ 进入PI Planning] [📊 导出报告]   │ │   │
│ │ └─────────────────────────────────────────────────────┘ │   │
│ │                                                           │   │
│ │                                                           │   │
│ │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━       │   │
│ │ 🎯 PI-2：PP车 PI (PP PI)                                 │   │
│ │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━       │   │
│ │                                                           │   │
│ │ ⏱️ 时间范围                                              │   │
│ │ ┌─────────────────────────────────────────────────────┐ │   │
│ │ │ 开始：2025-04-26 | 结束：2025-07-18                 │ │   │
│ │ │ 迭代区间：迭代7-12                                   │ │   │
│ │ │ 周期：12周                                           │ │   │
│ │ └─────────────────────────────────────────────────────┘ │   │
│ │                                                           │   │
│ │ 🏁 里程碑对齐                                             │   │
│ │ ┌─────────────────────────────────────────────────────┐ │   │
│ │ │ 对齐里程碑：PP车（PP）- 2025-09-30                  │ │   │
│ │ │ Buffer：74天                                         │ │   │
│ │ │ 对齐状态：🟡 紧张                                    │ │   │
│ │ └─────────────────────────────────────────────────────┘ │   │
│ │                                                           │   │
│ │ 📦 包含版本（4个）                                        │   │
│ │ ┌─────────────────────────────────────────────────────┐ │   │
│ │ │ • ADAS ECU V1.1        │ 100% │ 100 SP │ 迭代7-12│ │   │
│ │ │ • 座舱HMI V1.1         │ 80%  │ 64 SP  │ 迭代7-12│ │   │
│ │ │ • OTA V1.0             │ 100% │ 90 SP  │ 迭代8-12│ │   │
│ │ │ • 云服务 V1.0          │ 100% │ 120 SP │ 迭代7-11│ │   │
│ │ └─────────────────────────────────────────────────────┘ │   │
│ │                                                           │   │
│ │ 🎯 Epic范围                                               │   │
│ │ ┌─────────────────────────────────────────────────────┐ │   │
│ │ │ Epic数量：8个                                        │ │   │
│ │ │ 总Story Points：374 SP                              │ │   │
│ │ │ 预估Feature：28个                                    │ │   │
│ │ └─────────────────────────────────────────────────────┘ │   │
│ │                                                           │   │
│ │ 📊 执行状态                                               │   │
│ │ ┌─────────────────────────────────────────────────────┐ │   │
│ │ │ 规划状态：⏳ 待规划                                  │ │   │
│ │ │ PI Planning：❌ 未开始                               │ │   │
│ │ │ 执行进度：0% (尚未开始)                              │ │   │
│ │ └─────────────────────────────────────────────────────┘ │   │
│ │                                                           │   │
│ │ 🔧 操作按钮                                               │   │
│ │ ┌─────────────────────────────────────────────────────┐ │   │
│ │ │ [👁️ 查看详情] [➡️ 进入PI Planning] [📊 导出报告]   │ │   │
│ │ └─────────────────────────────────────────────────────┘ │   │
│ │                                                           │   │
│ │                                                           │   │
│ │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━       │   │
│ │ 🎯 PI-3：量产车 PI (SOP PI)                              │   │
│ │ [省略，结构同上]                                          │   │
│ │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━       │   │
│ │                                                           │   │
│ └──────────────────────────────────────────────────────────┘   │
└────────────────────────────────────────────────────────────────┘
```

---

## 🔧 关键交互

### 交互1：刷新PI集合

**触发方式**：点击"刷新PI集合"按钮

**交互流程**：

```
1. 点击"刷新PI集合"
   ↓
2. 系统检查版本规划数据
   - 是否有版本更新
   - 版本对齐状态是否变化
   ↓
3. 显示确认对话框
   "PI集合将重新生成，现有PI Planning数据将保留，是否继续？"
   提示：已经完成PI Planning的PI不会丢失数据
   [取消] [确认]
   ↓
4. 确认后，执行PI生成算法
   - 按里程碑分组版本
   - 计算PI迭代区间
   - 汇总PI范围
   ↓
5. 刷新页面显示
   显示成功消息："PI集合已更新"
   高亮变化的PI卡片
```

---

### 交互2：查看PI详情

**触发方式**：点击PI卡片的"查看详情"

**交互流程**：

```
1. 点击"查看详情"
   ↓
2. 弹出PI详情对话框（或跳转到详情页）
   ↓
3. 显示详细信息：
   - PI基本信息
   - 包含版本的详细列表（Epic明细）
   - Epic列表（每个Epic的来源版本）
   - Feature预估（如果已细化）
   - 团队分配统计（如果已分配）
   - 依赖关系（如果已标注）
   ↓
4. 提供操作：
   - 进入PI Planning
   - 导出详细报告
   - 查看Timeline
```

---

### 交互3：进入PI Planning

**触发方式**：点击"进入PI Planning"按钮

**交互流程**：

```
1. 点击"进入PI Planning"
   ↓
2. 检查PI状态
   if PI Planning未开始
     显示引导对话框：
     "即将进入PI Planning工作台，开始Feature细化和团队分配"
     [取消] [开始PI Planning]
   ↓
3. 跳转到PI Planning工作台
   URL: /function/c3-planning/pi-planning-workspace/:piId
   ↓
4. 加载PI Planning页面
   - 加载PI范围的所有Feature
   - 显示团队容量
   - 显示迭代×团队矩阵
```

---

### 交互4：导出PI报告

**触发方式**：点击"导出报告"按钮

**交互流程**：

```
1. 点击"导出报告"
   ↓
2. 弹出导出选项对话框
   选择导出内容：
   ☑ PI基本信息
   ☑ 包含版本列表
   ☑ Epic范围明细
   ☐ Feature列表（如果已细化）
   ☐ 团队分配（如果已分配）
   
   选择导出格式：
   ⭕ Excel
   ⭕ PDF
   ⭕ Markdown
   
   [取消] [导出]
   ↓
3. 生成报告并下载
   文件名：PI-1-工程样车PI-报告-2025-01-20.xlsx
```

---

## 💾 数据模型

### 数据结构

```typescript
// PI集合数据
interface PICollection {
  projectId: string
  projectName: string
  pis: PI[]
  statistics: {
    totalPIs: number
    totalVersions: number
    totalEpics: number
    totalStoryPoints: number
  }
  lastGeneratedAt: string
}

// PI详细信息
interface PI {
  piId: string
  piNumber: string  // PI-1
  piName: string    // 工程样车PI
  
  // 时间范围
  startDate: string
  endDate: string
  startIterationNumber: number
  endIterationNumber: number
  iterationCount: number
  durationWeeks: number
  
  // 里程碑对齐
  alignedMilestone: {
    milestoneId: string
    milestoneName: string
    targetDate: string
  }
  milestoneGap: number  // 66天
  alignmentStatus: 'good' | 'tight' | 'risk'
  
  // 包含版本
  includedVersions: Array<{
    versionId: string
    productId: string
    productName: string
    versionNumber: string
    completionPercentage: number
    storyPoints: number
    iterationRange: string
  }>
  
  // Epic范围
  epicIds: string[]
  epicCount: number
  totalStoryPoints: number
  estimatedFeatures: number
  
  // 执行状态
  status: {
    planningStatus: 'draft' | 'confirmed' | 'in-progress' | 'completed'
    piPlanningStatus: 'not-started' | 'in-progress' | 'completed'
    executionProgress: number  // 0-100
  }
  
  // 元数据
  isAutoGenerated: boolean
  createdAt: string
  updatedAt: string
}
```

---

## 🔌 API接口

### 接口列表

#### 1. 获取PI集合

```typescript
GET /api/projects/{projectId}/pi-collection

Response:
{
  projectId: string
  projectName: string
  pis: PI[]
  statistics: { ... }
  lastGeneratedAt: string
}
```

#### 2. 刷新PI集合

```typescript
POST /api/projects/{projectId}/pi-collection/refresh

Response:
{
  pis: PI[]
  changes: {
    added: PI[]
    updated: PI[]
    removed: PI[]
  }
  message: string
}
```

#### 3. 获取PI详情

```typescript
GET /api/projects/{projectId}/pis/{piId}/details

Response:
{
  pi: PI
  epicDetails: Epic[]
  featureCount: number
  teamAllocationSummary: { ... }
}
```

#### 4. 导出PI报告

```typescript
POST /api/projects/{projectId}/pis/{piId}/export

Request Body:
{
  includeVersions: boolean
  includeEpics: boolean
  includeFeatures: boolean
  includeTeamAllocation: boolean
  format: 'excel' | 'pdf' | 'markdown'
}

Response:
{
  fileUrl: string
  fileName: string
}
```

---

## 🎨 视觉设计

### PI卡片样式

```scss
.pi-card {
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  padding: 24px;
  margin-bottom: 24px;
  background: #ffffff;
  transition: all 0.3s;
  
  &:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  
  .pi-header {
    font-size: 20px;
    font-weight: 600;
    color: #212121;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 12px;
    
    .pi-icon {
      font-size: 24px;
    }
  }
  
  .pi-section {
    margin-bottom: 16px;
    
    .section-title {
      font-size: 14px;
      font-weight: 600;
      color: #616161;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .section-content {
      padding: 12px;
      background: #f5f5f5;
      border-radius: 4px;
    }
  }
  
  .version-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    
    .version-item {
      display: flex;
      justify-content: space-between;
      padding: 8px;
      background: #ffffff;
      border-radius: 4px;
      
      &:hover {
        background: #e3f2fd;
      }
    }
  }
  
  .alignment-status {
    &.good {
      color: #4caf50;
      font-weight: 600;
    }
    
    &.tight {
      color: #ff9800;
      font-weight: 600;
    }
    
    &.risk {
      color: #f44336;
      font-weight: 600;
    }
  }
  
  .action-buttons {
    display: flex;
    gap: 12px;
    margin-top: 16px;
  }
}
```

### 对齐状态颜色

| 状态 | 颜色 | 背景色 |
|------|------|--------|
| 良好 🟢 | `#4caf50` | `#e8f5e9` |
| 紧张 🟡 | `#ff9800` | `#fff3e0` |
| 风险 🔴 | `#f44336` | `#ffebee` |

---

## ✅ 验证规则

### 业务规则

1. **PI生成规则**
   - PI必须基于版本规划生成
   - 每个里程碑对应一个PI
   - PI迭代区间 = 所有对齐该里程碑的版本的并集

2. **PI更新规则**
   - 版本规划变化时，可刷新PI集合
   - 已完成PI Planning的PI保留Feature分配数据
   - PI数量可能增加或减少（取决于里程碑和版本）

3. **PI Planning前置条件**
   - PI必须包含至少1个版本
   - 版本必须分配了Epic
   - 项目必须配置了团队

---

## 🚀 实施要点

### 核心组件

```
PICollectionView.vue                        # 主页面
├── PICollectionHeader.vue                  # 顶部操作栏
├── PIStatistics.vue                        # 统计概览
├── PICardList.vue                          # PI卡片列表
│   └── PICard.vue                          # PI卡片
│       ├── TimeRangeSection.vue            # 时间范围
│       ├── MilestoneAlignmentSection.vue   # 里程碑对齐
│       ├── VersionListSection.vue          # 版本列表
│       ├── EpicScopeSection.vue            # Epic范围
│       └── StatusSection.vue               # 执行状态
├── PIDetailDialog.vue                      # PI详情对话框
└── ExportDialog.vue                        # 导出对话框
```

### PI自动生成算法（核心）

```typescript
function generatePICollection(project: Project): PI[] {
  const pis: PI[] = []
  
  // 1. 按里程碑分组版本
  const milestones = project.milestones.sort((a, b) => 
    new Date(a.targetDate).getTime() - new Date(b.targetDate).getTime()
  )
  
  for (const milestone of milestones) {
    // 2. 找到对齐该里程碑的所有版本
    const alignedVersions = project.versions.filter(v => 
      v.alignedMilestoneId === milestone.milestoneId
    )
    
    if (alignedVersions.length === 0) {
      continue  // 该里程碑没有版本，跳过
    }
    
    // 3. 计算PI的迭代区间（所有版本的并集）
    const startIterationNumber = Math.min(
      ...alignedVersions.map(v => v.startIterationNumber)
    )
    const endIterationNumber = Math.max(
      ...alignedVersions.map(v => v.endIterationNumber)
    )
    
    // 4. 汇总Epic范围
    const allEpicIds = [...new Set(alignedVersions.flatMap(v => v.epicIds))]
    const totalStoryPoints = alignedVersions.reduce(
      (sum, v) => sum + v.totalStoryPoints, 0
    )
    
    // 5. 创建PI
    const pi: PI = {
      piId: generateId(),
      piNumber: `PI-${pis.length + 1}`,
      piName: `${milestone.milestoneName} PI`,
      
      startIterationNumber,
      endIterationNumber,
      iterationCount: endIterationNumber - startIterationNumber + 1,
      
      alignedMilestone: milestone,
      milestoneGap: calculateDays(
        project.getIterationEndDate(endIterationNumber),
        milestone.targetDate
      ),
      
      includedVersions: alignedVersions,
      epicIds: allEpicIds,
      epicCount: allEpicIds.length,
      totalStoryPoints,
      
      isAutoGenerated: true,
      status: {
        planningStatus: 'draft',
        piPlanningStatus: 'not-started',
        executionProgress: 0
      }
    }
    
    pis.push(pi)
  }
  
  return pis
}
```

---

## 📊 与NIO NSDP对比

### PI管理对比

| 维度 | NIO NSDP | 本系统 | 说明 |
|------|----------|--------|------|
| **PI创建方式** | ❓ 未知 | ✅ 自动生成 | 本系统创新点 |
| **PI视图** | ❓ 未知 | ✅ 卡片式展示 | 清晰展示 |
| **版本关联** | ✅ 有 | ✅ 版本汇总 | 功能对齐 |
| **里程碑对齐** | ✅ 有 | ✅ 对齐状态 | 概念一致 |

---

## 📝 测试用例

### 测试场景

| 场景 | 测试步骤 | 预期结果 |
|------|---------|---------|
| **TC-PI-01** | 进入PI集合视图 | 显示所有自动生成的PI |
| **TC-PI-02** | 点击刷新PI集合 | PI集合重新生成 |
| **TC-PI-03** | 查看PI详情 | 显示PI详细信息 |
| **TC-PI-04** | 进入PI Planning | 跳转到PI Planning工作台 |
| **TC-PI-05** | 导出PI报告 | 成功下载报告文件 |
| **TC-PI-06** | 版本规划变化后刷新 | PI集合更新，高亮变化 |

---

**页面设计**: V3.0  
**状态**: ✅ **设计完成，待实施**  
**下一步**: 集成到项目Timeline

---

**END OF DOCUMENT**
