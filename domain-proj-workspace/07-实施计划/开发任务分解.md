# 开发任务分解

> **文档版本**: V1.0  
> **创建时间**: 2026-01-20  
> **实施范围**: 前端开发任务

---

## 一、任务概览

### 1.1 总体目标
实现领域项目管理能力域的前端功能，包括项目创建、版本规划（含完成度管理）、PI规划（含里程碑映射）。

### 1.2 技术栈
- Vue 3 + TypeScript
- Pinia (状态管理)
- Element Plus (UI组件)
- Vue Router (路由)

### 1.3 开发周期
**预计**: 2-3周（假设1个全职前端开发）

---

## 二、任务分解

### 阶段1: 基础设施 (2-3天)

#### Task 1.1: TypeScript类型定义
**优先级**: P0  
**工作量**: 4小时  
**产出**:
- `types/project.ts` - 项目相关类型
- `types/version.ts` - 版本相关类型（含完成度）
- `types/pi.ts` - PI相关类型
- `types/milestone.ts` - 里程碑相关类型

#### Task 1.2: Pinia Store实现
**优先级**: P0  
**工作量**: 8小时  
**产出**:
- `stores/modules/project.ts`
- `stores/modules/version.ts`
- `stores/modules/pi.ts`
- `stores/modules/milestone.ts`

#### Task 1.3: Mock数据和API
**优先级**: P0  
**工作量**: 4小时  
**产出**:
- `mock-data/projects.json`
- `mock-data/versions.json`
- `mock-data/pis.json`
- `mock-data/milestones.json`
- `api/project.ts`, `api/version.ts`, `api/pi.ts`, `api/milestone.ts`

---

### 阶段2: 项目管理功能 (3-4天)

#### Task 2.1: 项目列表页
**优先级**: P0  
**工作量**: 6小时  
**页面**: `/function/c0/projects`  
**功能**:
- 项目列表展示（卡片式）
- 筛选（状态、车型）和搜索
- 跳转到项目详情

#### Task 2.2: 创建项目页
**优先级**: P0  
**工作量**: 8小时  
**页面**: `/function/c0/projects/create`  
**功能**:
- 步骤表单（3步）
- 基本信息填写
- PI框架设置（自动生成时间线）
- 草稿保存

#### Task 2.3: 项目详情页
**优先级**: P0  
**工作量**: 6小时  
**页面**: `/function/c0/projects/:id`  
**功能**:
- 项目信息展示
- Tab切换（版本、PI、里程碑）
- 统计数据

---

### 阶段3: 版本规划功能 ⭐核心 (4-5天)

#### Task 3.1: 版本列表页
**优先级**: P0  
**工作量**: 4小时  
**页面**: `/function/c0/projects/:id/versions`  
**功能**:
- 版本列表（卡片式）
- 状态筛选
- 进度展示

#### Task 3.2: 创建版本页 ⭐核心创新
**优先级**: P0  
**工作量**: 12小时  
**页面**: `/function/c0/projects/:id/versions/create`  
**功能**:
- 版本基本信息
- 关联里程碑
- **Epic选择器**
- **Epic完成度设置**（0-100%）⭐
- **Feature完成度设置**（精细化）⭐
- 完成度验证
- 版本规模计算

**关键组件**:
- `EpicSelector.vue` - Epic选择器
- `CompletionSlider.vue` - 完成度滑块
- `FeatureCompletionDialog.vue` - Feature完成度设置弹窗

#### Task 3.3: 版本详情页
**优先级**: P1  
**工作量**: 6小时  
**页面**: `/function/c0/projects/:id/versions/:versionId`  
**功能**:
- 版本信息展示
- Epic分配列表（含完成度）
- 进度可视化
- 编辑完成度

---

### 阶段4: PI规划功能 ⭐核心 (4-5天)

#### Task 4.1: PI列表页
**优先级**: P0  
**工作量**: 4小时  
**页面**: `/function/c0/projects/:id/pis`  
**功能**:
- PI时间线展示
- PI卡片展示
- 状态标识

#### Task 4.2: 创建PI页 ⭐核心创新
**优先级**: P0  
**工作量**: 12小时  
**页面**: `/function/c0/projects/:id/pis/create`  
**功能**:
- PI基本信息
- **固定时间盒计算**（12周）⭐
- **里程碑对齐检查**（±7天）⭐
- **日期调整建议**⭐
- 版本范围选择
- PI目标设置
- 团队负载率计算

**关键组件**:
- `MilestoneAlignmentChecker.vue` - 里程碑对齐检查器⭐
- `PITimelineVisualization.vue` - PI时间线可视化
- `TeamLoadRateChart.vue` - 团队负载率图表

#### Task 4.3: PI详情页
**优先级**: P1  
**工作量**: 6小时  
**页面**: `/function/c0/projects/:id/pis/:piId`  
**功能**:
- PI信息展示
- 目标列表
- 团队分配
- 进度跟踪
- 进入PI Planning

---

### 阶段5: 里程碑管理 (2-3天)

#### Task 5.1: 里程碑列表
**优先级**: P1  
**工作量**: 4小时  
**页面**: `/function/c0/projects/:id/milestones`  
**功能**:
- 里程碑时间线
- 类型分组
- 关联信息

#### Task 5.2: 创建里程碑
**优先级**: P1  
**工作量**: 6小时  
**功能**:
- 里程碑表单
- 推荐关联PI
- 交付物管理

---

## 三、优先级排序

### P0 - 必须完成（MVP）
1. ✅ 基础设施（TypeScript + Store + Mock数据）
2. ✅ 项目管理（列表、创建、详情）
3. ⭐ **版本规划（含完成度管理）** - 核心创新
4. ⭐ **PI规划（含里程碑映射）** - 核心创新

### P1 - 重要功能
5. 版本详情页（编辑完成度）
6. PI详情页
7. 里程碑管理

### P2 - 优化功能
8. 数据可视化增强
9. 批量操作
10. 导出功能

---

## 四、关键组件设计

### 组件1: Epic完成度设置器 ⭐核心

```vue
<!-- components/EpicCompletionSetter.vue -->
<template>
  <div class="epic-completion-setter">
    <!-- Epic基本信息 -->
    <el-card>
      <div class="epic-header">
        <h4>{{ epic.epicName }}</h4>
        <el-tag>总SP: {{ epic.storyPoints }}</el-tag>
      </div>
      
      <!-- 完成度滑块 -->
      <div class="completion-slider">
        <label>Epic完成度目标</label>
        <el-slider
          v-model="completionTarget"
          :min="0"
          :max="100"
          :step="5"
          show-stops
          @change="handleCompletionChange"
        />
        <span class="target-sp">
          目标SP: {{ targetStoryPoints }} ({{ completionTarget }}%)
        </span>
      </div>
      
      <!-- Feature精细化按钮 -->
      <el-button
        type="primary"
        plain
        @click="showFeatureDialog = true"
      >
        精细化到Feature
      </el-button>
    </el-card>
    
    <!-- Feature完成度弹窗 -->
    <el-dialog
      v-model="showFeatureDialog"
      title="Feature完成度设置"
      width="800px"
    >
      <el-table :data="epic.features">
        <el-table-column prop="featureName" label="Feature" />
        <el-table-column prop="storyPoints" label="总SP" />
        <el-table-column label="完成度">
          <template #default="{ row }">
            <el-slider
              v-model="row.completionTarget"
              :min="0"
              :max="100"
              @change="recalculateTotal"
            />
          </template>
        </el-table-column>
        <el-table-column label="目标SP">
          <template #default="{ row }">
            {{ Math.round(row.storyPoints * row.completionTarget / 100) }}
          </template>
        </el-table-column>
      </el-table>
      
      <template #footer>
        <div class="dialog-footer">
          <span class="total-info">
            Feature总完成度: {{ featureTotalCompletion }}%
            （Epic目标: {{ completionTarget }}%）
          </span>
          <el-button @click="showFeatureDialog = false">取消</el-button>
          <el-button type="primary" @click="confirmFeatureCompletion">
            确认
          </el-button>
        </div>
      </template>
    </el-dialog>
  </div>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue'

const props = defineProps<{
  epic: Epic
}>()

const completionTarget = ref(80)
const showFeatureDialog = ref(false)

const targetStoryPoints = computed(() => {
  return Math.round(props.epic.storyPoints * completionTarget.value / 100)
})

const featureTotalCompletion = computed(() => {
  // 计算Feature完成度总和
  const total = props.epic.features.reduce((sum, f) => {
    return sum + (f.storyPoints * f.completionTarget / 100)
  }, 0)
  return Math.round(total / props.epic.storyPoints * 100)
})

function handleCompletionChange() {
  // 验证并更新
}

function recalculateTotal() {
  // 重新计算总完成度
}

function confirmFeatureCompletion() {
  // 验证Feature完成度与Epic目标一致
  if (Math.abs(featureTotalCompletion.value - completionTarget.value) > 1) {
    ElMessage.warning('Feature总完成度与Epic目标不一致')
    return
  }
  showFeatureDialog.value = false
}
</script>
```

---

### 组件2: 里程碑对齐检查器 ⭐核心

```vue
<!-- components/MilestoneAlignmentChecker.vue -->
<template>
  <div class="milestone-alignment-checker">
    <h4>里程碑对齐检查</h4>
    
    <div class="pi-info">
      <el-tag>PI结束日期: {{ piEndDate }}</el-tag>
    </div>
    
    <el-table :data="alignmentResults">
      <el-table-column prop="milestone.milestoneName" label="里程碑" />
      <el-table-column prop="milestone.targetDate" label="目标日期" />
      <el-table-column label="日期差">
        <template #default="{ row }">
          <span :class="getDiffClass(row.daysDiff)">
            {{ Math.abs(row.daysDiff) }}天
          </span>
        </template>
      </el-table-column>
      <el-table-column label="对齐程度">
        <template #default="{ row }">
          <el-tag :type="getAlignmentTagType(row.alignmentLevel)">
            {{ getAlignmentText(row.alignmentLevel) }}
          </el-tag>
        </template>
      </el-table-column>
      <el-table-column label="建议">
        <template #default="{ row }">
          {{ row.recommendation }}
        </template>
      </el-table-column>
      <el-table-column label="操作">
        <template #default="{ row }">
          <el-button
            v-if="row.alignmentLevel !== 'MISALIGNED'"
            type="primary"
            size="small"
            @click="selectMilestone(row.milestone)"
          >
            选择
          </el-button>
        </template>
      </el-table-column>
    </el-table>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import dayjs from 'dayjs'

const props = defineProps<{
  piEndDate: string
  milestones: Milestone[]
}>()

const emit = defineEmits<{
  select: [milestone: Milestone]
}>()

const alignmentResults = computed(() => {
  return props.milestones.map(milestone => {
    const daysDiff = dayjs(milestone.targetDate).diff(props.piEndDate, 'day')
    
    let alignmentLevel: 'PERFECT' | 'ACCEPTABLE' | 'MISALIGNED'
    let recommendation: string
    
    if (Math.abs(daysDiff) <= 7) {
      alignmentLevel = 'PERFECT'
      recommendation = '强烈建议关联'
    } else if (Math.abs(daysDiff) <= 14) {
      alignmentLevel = 'ACCEPTABLE'
      recommendation = '可考虑关联，需微调'
    } else {
      alignmentLevel = 'MISALIGNED'
      recommendation = '不建议关联'
    }
    
    return {
      milestone,
      daysDiff,
      alignmentLevel,
      recommendation
    }
  }).sort((a, b) => Math.abs(a.daysDiff) - Math.abs(b.daysDiff))
})

function getDiffClass(diff: number) {
  const abs = Math.abs(diff)
  if (abs <= 7) return 'perfect'
  if (abs <= 14) return 'acceptable'
  return 'misaligned'
}

function getAlignmentTagType(level: string) {
  return {
    'PERFECT': 'success',
    'ACCEPTABLE': 'warning',
    'MISALIGNED': 'info'
  }[level]
}

function getAlignmentText(level: string) {
  return {
    'PERFECT': '完美对齐',
    'ACCEPTABLE': '可接受',
    'MISALIGNED': '不对齐'
  }[level]
}

function selectMilestone(milestone: Milestone) {
  emit('select', milestone)
}
</script>

<style scoped>
.perfect { color: #67c23a; font-weight: bold; }
.acceptable { color: #e6a23c; }
.misaligned { color: #909399; }
</style>
```

---

## 五、工作量估算

| 阶段 | 任务数 | 工作量 | 周期 |
|------|-------|--------|------|
| 阶段1: 基础设施 | 3个 | 16小时 | 2-3天 |
| 阶段2: 项目管理 | 3个 | 20小时 | 3-4天 |
| 阶段3: 版本规划 ⭐ | 3个 | 22小时 | 4-5天 |
| 阶段4: PI规划 ⭐ | 3个 | 22小时 | 4-5天 |
| 阶段5: 里程碑管理 | 2个 | 10小时 | 2-3天 |
| **总计** | **14个** | **90小时** | **15-20天** |

**说明**: 假设1个全职前端开发，每天工作6小时有效开发时间。

---

## 六、里程碑

| 里程碑 | 交付内容 | 目标日期 |
|--------|---------|---------|
| M1: 基础完成 | TypeScript + Store + Mock数据 | Day 3 |
| M2: 项目管理完成 | 项目CRUD功能 | Day 7 |
| M3: 版本规划完成⭐ | 完成度管理功能 | Day 12 |
| M4: PI规划完成⭐ | 里程碑映射功能 | Day 17 |
| M5: 整体完成 | 全部功能+优化 | Day 20 |

---

**文档版本**: V1.0  
**创建时间**: 2026-01-20  
**预计工期**: 15-20工作日  
**核心创新**: 完成度管理 + 里程碑映射
