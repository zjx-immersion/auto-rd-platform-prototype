# PI Planning 概念调整总结

> 更新时间：2026-01-19  
> 版本：3.0.0

---

## 📋 调整背景

根据用户反馈，PI Planning工作台需要调整概念模型：
- ❌ **移除**："阶段1"和"阶段2"的线性流程概念
- ✅ **改为**："全局视角"和"团队视角"的并行视图概念
- ✅ **允许**：随时在两个视角之间自由切换，无需等待"完成"

---

## 🔄 概念变更对比

### 原概念（阶段模型）

```
阶段1: Feature/SSTS排布
  ↓ （需要完成）
  ↓ （解锁）
  ↓
阶段2: 模块需求排布
  ↓ （需要完成）
  ↓
PI Planning完成
```

**问题**：
- 强制线性流程
- 阶段2必须等待阶段1完成
- 不符合实际规划的灵活性需求
- 用户误以为是固定的工作流程

### 新概念（视角模型）

```
全局视角 ⇄ 团队视角
（Feature/SSTS排布）  （模块需求排布）

两个视角：
• 随时切换
• 独立编辑
• 数据同步
• 无依赖关系
```

**优势**：
- 灵活切换
- 并行工作
- 符合实际规划场景
- 明确功能定位

---

## 📝 具体修改内容

### 1. 页面标题和说明

| 位置 | 原文案 | 新文案 |
|------|--------|--------|
| 页面标题（页面1） | PI Planning - 阶段1: Feature/SSTS排布 | PI Planning - 全局视角: Feature/SSTS排布 |
| 页面标题（页面2） | PI Planning - 阶段2: 模块需求排布 | PI Planning - 团队视角: 模块需求排布 |
| 进度标签（页面1） | 阶段1进度 | 规划进度 |
| 进度标签（页面2） | 阶段1/阶段2进度 | 团队规划进度 |
| 注释和说明（页面2） | 来自阶段1 | 来自全局视角 |

### 2. 移除的功能

#### 全局视角（原阶段1）

- ❌ 移除："完成阶段1"按钮
- ❌ 移除：`stage1Completed` 变量
- ❌ 移除：`canCompleteStage1` computed
- ❌ 移除：`handleCompleteStage1()` 函数

**替换为**：
- ✅ "切换到团队视角"按钮（随时可用）
- ✅ "检测冲突"按钮（直接可用）
- ✅ "保存草稿"按钮（保持不变）

#### 团队视角（原阶段2）

- ❌ 移除："完成阶段2"按钮
- ❌ 移除：阶段1完成检查逻辑
- ❌ 移除：`handleCompleteStage2()` 函数
- ❌ 移除：`canCompleteStage2` computed

**替换为**：
- ✅ "切换到全局视角"按钮（随时可用）
- ✅ "保存草稿"按钮（保持不变）
- ✅ 保留团队规划状态跟踪（但不强制"完成"流程）

### 3. 保留的功能

#### 数据保存

- ✅ **草稿保存**：两个视角都支持保存草稿到localStorage
- ✅ **数据同步**：团队视角可以读取全局视角的分配结果
- ✅ **状态跟踪**：团队视角仍然跟踪各团队的规划状态（`teamCompletionStatus`）

#### 数据读取

- ✅ **全局视角**：读取`pi-planning-stage1-draft-${piId}`
- ✅ **团队视角**：读取全局视角的草稿（不检查完成状态）+ 自己的`pi-planning-stage2-draft-${piId}`

---

## 🎯 用户体验改进

### Before（阶段模型）

```
用户流程：
1. 进入阶段1页面
2. 分配Feature/SSTS
3. 点击"完成阶段1"
4. 点击"进入阶段2"（按钮解锁）
5. 进入阶段2页面
6. 分配MR
7. 点击"完成阶段2"

限制：
❌ 必须完成阶段1才能进入阶段2
❌ 不能在阶段2修改后返回阶段1
❌ 强制线性流程
```

### After（视角模型）

```
用户流程：
1. 进入全局视角或团队视角（任意入口）
2. 规划分配
3. 点击"保存草稿"（随时保存）
4. 点击"切换视角"（随时切换）
5. 在另一个视角继续规划
6. 重复2-5步骤，直到规划满意

优势：
✅ 可以随时切换视角
✅ 可以多次往返编辑
✅ 灵活的工作流程
✅ 符合实际规划习惯
```

---

## 📊 代码变更统计

### 文件修改

| 文件 | 修改类型 | 主要变更 |
|------|---------|----------|
| PIPlanningStage1.vue | 重大修改 | 移除阶段完成逻辑，更新文案 |
| PIPlanningStage2.vue | 重大修改 | 移除阶段依赖检查，更新文案 |

### 变量和函数

| 类型 | 移除 | 保留 | 新增 |
|------|------|------|------|
| 变量 | `stage1Completed` | `stage1Allocations`, `stage2MRAllocations`, `teamCompletionStatus` | - |
| 函数 | `handleCompleteStage1()`, `handleCompleteStage2()`, `canCompleteStage1`, `canCompleteStage2` | `handleSaveDraft()`, `handleGoToStage2()`, `getTeamStage2Status()` | - |
| UI组件 | "完成阶段"按钮 | "保存草稿"按钮, "切换视角"按钮 | - |

### 代码行数

- **删除行数**：~50行（移除阶段完成相关逻辑）
- **修改行数**：~30行（更新文案和注释）
- **新增行数**：~5行（添加注释说明）

---

## ✅ 验证清单

### 全局视角页面

- [x] 页面标题显示："全局视角: Feature/SSTS排布"
- [x] 进度标签显示："规划进度"
- [x] 存在"切换到团队视角"按钮
- [x] 存在"检测冲突"按钮
- [x] 存在"保存草稿"按钮
- [x] 不存在"完成阶段1"按钮
- [x] 不存在"进入阶段2"按钮
- [x] 点击"切换到团队视角"可跳转（无需检查完成状态）

### 团队视角页面

- [x] 页面标题显示："团队视角: 模块需求排布"
- [x] 进度标签显示："团队规划进度"
- [x] 团队选择卡片显示："单团队视角"说明
- [x] 存在"切换到全局视角"按钮
- [x] 存在"保存草稿"按钮
- [x] 不存在"完成阶段2"按钮
- [x] 不存在"阶段1已完成"标签
- [x] 左侧显示"全局视角分配（只读）"（而不是"阶段1分配"）
- [x] 打开页面时不检查阶段1是否完成
- [x] 点击"切换到全局视角"可跳转

### 数据同步

- [x] 在全局视角保存数据后，切换到团队视角可以看到分配结果
- [x] 在团队视角保存数据后，再次打开可以恢复
- [x] 两个视角的数据独立存储
- [x] 清除localStorage后，两个视角都重置

---

## 📚 相关文档

- **原设计文档**: `C3-F18-PI-Planning-2阶段规划工作台.md`（需更新）
- **功能对比文档**: `STAGE1-VS-STAGE2-DIFFERENCES.md`（需更新）
- **修复报告**: `PI-PLANNING-TEST-FEEDBACK-FIXES.md`
- **本文档**: `PI-PLANNING-CONCEPT-CHANGE-SUMMARY.md`

---

## 🎯 后续建议

### 短期（必须）

1. ✅ **文案统一**：确保所有文档和注释中不再出现"阶段1"、"阶段2"
2. ✅ **用户引导**：更新用户指南，说明新的视角切换模式
3. ✅ **测试验证**：完整测试两个视角的切换和数据同步

### 中期（建议）

1. **路由重命名**：
   - `/pi/:piId/stage1` → `/pi/:piId/global`
   - `/pi/:piId/stage2` → `/pi/:piId/team`

2. **文件重命名**：
   - `PIPlanningStage1.vue` → `PIPlanningGlobalView.vue`
   - `PIPlanningStage2.vue` → `PIPlanningTeamView.vue`

3. **localStorage key重命名**：
   - `pi-planning-stage1-draft-${piId}` → `pi-planning-global-draft-${piId}`
   - `pi-planning-stage2-draft-${piId}` → `pi-planning-team-draft-${piId}`

### 长期（优化）

1. **视觉区分**：
   - 全局视角使用蓝色主题
   - 团队视角使用绿色主题

2. **实时同步**：
   - 在全局视角修改时，如果团队视角页面已打开，实时更新
   - 考虑使用WebSocket或轮询

3. **历史记录**：
   - 记录视角切换历史
   - 支持快速返回上一次编辑的位置

---

## 🎉 总结

### 变更核心

- **概念升级**：从"阶段"到"视角"
- **交互优化**：从"线性"到"并行"
- **灵活性提升**：从"强制完成"到"自由切换"

### 用户价值

1. **更自然的工作流**：符合实际PI Planning的灵活性需求
2. **更高的效率**：可以随时在两个视角间切换，不必等待
3. **更清晰的定位**：每个视角的功能和目的更明确

### 技术债务

- 文件名和路由仍使用"stage1"、"stage2"（建议未来重命名）
- localStorage key仍使用"stage"前缀（建议未来重命名）
- 部分注释仍可能存在"阶段"的说法（需全面review）

---

**文档版本**: 3.0.0  
**最后更新**: 2026-01-19  
**维护人员**: 开发团队
