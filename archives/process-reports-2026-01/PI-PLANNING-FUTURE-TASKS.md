# PI Planning 2阶段规划工作台 - 后续任务清单

> 更新日期：2026-01-19  
> 状态：待规划

---

## 📋 任务分类说明

- **P0 - 立即优先**：影响核心功能，需要立即完成
- **P1 - 重要**：提升用户体验，近期完成
- **P2 - 增强**：系统集成和稳定性，中期完成
- **P3 - 扩展**：高级功能，长期规划

---

## 🔴 P0 - 立即优先（功能完善）

### 1. 完善依赖检查逻辑

**当前问题**：
- 依赖检查仅基于Sprint时间顺序
- 无法显示完整的依赖链路径
- 依赖冲突信息不够详细

**待实现**：
- [ ] **跨Sprint依赖检查**
  - 检查SSTS的依赖是否都已分配
  - 检查依赖的SSTS是否在更早或相同的Sprint
  - 检查MR的依赖是否都已分配
  
- [ ] **依赖路径显示**
  - 显示完整的依赖链（A → B → C）
  - 标识循环依赖
  - 显示依赖深度
  
- [ ] **冲突详情**
  - 列出所有冲突项
  - 显示冲突原因和影响
  - 提供解决建议

**验收标准**：
- 能正确检测所有类型的依赖冲突
- 依赖路径清晰可读
- 冲突信息详细完整

---

### 2. 数据完整性补充

**当前问题**：
- 整车计划节点数据为空
- 产品版本数据不完整
- 测试数据覆盖场景有限

**待实现**：
- [ ] **整车计划节点管理**
  - 创建整车节点数据表
  - 实现节点CRUD功能
  - 关联到Sprint里程碑
  
- [ ] **产品版本完善**
  - 补充产品版本详细信息
  - 添加版本依赖关系
  - 实现版本管理界面
  
- [ ] **测试数据扩充**
  - 添加更多Feature和SSTS
  - 创建复杂依赖关系场景
  - 添加边界情况数据（如空数据、超大数据）

**数据结构**：
```typescript
// 整车计划节点
interface VehicleNode {
  id: string
  code: string
  name: string
  type: 'SOP' | 'B样车' | 'C样车' | 'PPAP' | 'OTS' | 'PVS'
  date: ISODate
  milestone: string
  description?: string
  productId: string
  dependencies?: string[]
}
```

**验收标准**：
- 整车节点数据完整可用
- 可以在里程碑设置中选择整车节点
- 测试数据覆盖各种场景

---

### 3. 测试覆盖完善

**当前问题**：
- E2E测试用例不够全面
- 缺少边界情况测试
- 拖拽操作测试不完整

**待实现**：
- [ ] **边界情况测试**
  - 空数据情况
  - 超大数据量（100+ Feature/SSTS）
  - 容量边界（刚好满、超载）
  - 依赖循环检测
  
- [ ] **拖拽操作测试**
  - 拖拽到有效位置
  - 拖拽到无效位置
  - 拖拽取消
  - 拖拽到容量已满的Sprint
  
- [ ] **状态转换测试**
  - 阶段1未完成时访问阶段2
  - 阶段1完成后进入阶段2
  - 草稿保存和恢复
  - 多次编辑和保存

**测试场景文档**：创建 `tests/test-scenarios.md` 详细描述所有测试场景

**验收标准**：
- 测试覆盖率达到80%以上
- 所有边界情况都有测试
- 测试可以自动化运行

---

## 🟡 P1 - 重要（用户体验优化）

### 1. 依赖关系可视化

**需求背景**：
- 当前依赖关系仅通过列表显示
- 复杂依赖关系难以理解
- 需要更直观的可视化方式

**待实现**：
- [ ] **依赖关系图**
  - 使用D3.js或ECharts实现
  - 显示SSTS之间的依赖连线
  - 支持缩放和拖拽
  
- [ ] **依赖路径高亮**
  - 选中SSTS时高亮整条依赖路径
  - 区分不同依赖类型（强/弱/可选）
  - 显示依赖方向
  
- [ ] **依赖层级视图**
  - 按依赖深度分层显示
  - 识别关键路径
  - 显示依赖统计信息

**技术方案**：
- 使用 `vue-echarts` 或 `d3.js`
- 数据结构：节点+边
- 支持力导向布局或层次布局

**验收标准**：
- 依赖关系图清晰易懂
- 交互流畅，性能良好
- 支持大规模依赖关系（50+节点）

---

### 2. 批量操作功能

**需求背景**：
- 单个分配效率低
- 批量操作需求强烈

**待实现**：
- [ ] **批量选择**
  - Ctrl/Shift+点击多选
  - 全选/反选
  - 按条件筛选后批量选择
  
- [ ] **批量分配**
  - 将多个Feature/SSTS批量分配到同一Sprint
  - 按团队批量分配
  - 按优先级批量分配
  
- [ ] **批量操作**
  - 批量删除分配
  - 批量修改属性
  - 批量添加标签

**UI设计**：
- 复选框模式
- 批量操作工具栏
- 操作确认对话框

**验收标准**：
- 支持Ctrl/Shift多选
- 批量操作响应快速
- 有清晰的操作反馈

---

### 3. 快捷键支持

**需求背景**：
- 提升操作效率
- 减少鼠标操作

**待实现**：
- [ ] **基础快捷键**
  - `Ctrl+S`: 保存草稿
  - `Ctrl+Z`: 撤销操作
  - `Ctrl+Y`: 重做操作
  - `Esc`: 取消当前操作
  
- [ ] **导航快捷键**
  - `Ctrl+F`: 搜索
  - `Ctrl+K`: 快速跳转
  - `Tab`: 切换焦点
  
- [ ] **操作快捷键**
  - `Delete`: 删除选中项
  - `Ctrl+A`: 全选
  - `Ctrl+D`: 取消选择

**技术实现**：
- 使用 `@vueuse/core` 的 `useMagicKeys`
- 全局快捷键管理
- 快捷键冲突检测

**验收标准**：
- 所有快捷键正常工作
- 有快捷键帮助文档
- 快捷键可自定义

---

### 4. 拖拽体验优化

**需求背景**：
- 当前拖拽体验较基础
- 缺少视觉反馈

**待实现**：
- [ ] **拖拽预览**
  - 显示拖拽的卡片缩略图
  - 显示目标位置的容量预览
  - 显示是否可放置的提示
  
- [ ] **动画效果**
  - 拖拽时的平滑动画
  - 放置时的展开动画
  - 删除时的淡出动画
  
- [ ] **拖拽辅助**
  - 自动滚动（拖拽到边缘时）
  - 吸附效果（接近目标时）
  - 拖拽指引线

**技术方案**：
- 考虑使用 `@dnd-kit/core` 替换原生Drag and Drop
- Vue Transition组件
- CSS动画和过渡

**验收标准**：
- 拖拽流畅，无卡顿
- 视觉反馈清晰
- 支持移动端（触摸）

---

### 5. 数据导出导入

**需求背景**：
- 需要导出规划结果给相关方
- 需要从外部系统导入数据

**待实现**：
- [ ] **导出功能**
  - 导出为Excel（规划矩阵）
  - 导出为PDF（规划报告）
  - 导出为JSON（备份）
  
- [ ] **导入功能**
  - 从Excel导入Feature/SSTS
  - 从CSV导入团队/容量数据
  - 导入时数据校验
  
- [ ] **模板支持**
  - 提供Excel导入模板
  - 字段映射配置
  - 批量导入错误报告

**技术方案**：
- 使用 `xlsx` 库处理Excel
- 使用 `jsPDF` 生成PDF
- 前端数据校验

**验收标准**：
- 导出数据完整准确
- 导入数据校验严格
- 支持大批量数据

---

## 🟢 P2 - 增强（系统集成和稳定性）

### 1. 后端API集成

**需求背景**：
- 当前使用localStorage，数据不持久
- 需要多用户协作
- 需要与其他系统集成

**待实现**：
- [ ] **API设计**
  - RESTful API设计文档
  - API版本管理
  - 错误码定义
  
- [ ] **核心接口**
  - PI Planning CRUD
  - Feature/SSTS/MR查询和更新
  - 依赖关系管理
  - 里程碑管理
  
- [ ] **数据同步**
  - 增量更新
  - 冲突解决策略
  - 离线支持

**API示例**：
```typescript
// GET /api/v1/pi-planning/:piId/stage1
// POST /api/v1/pi-planning/:piId/stage1/allocations
// PUT /api/v1/pi-planning/:piId/stage1/dependencies
// DELETE /api/v1/pi-planning/:piId/stage1/allocations/:id
```

**验收标准**：
- API文档完整
- 接口响应时间 < 200ms
- 支持并发请求

---

### 2. 规划历史管理

**需求背景**：
- 需要追溯规划变更
- 需要对比不同版本
- 需要回滚到历史版本

**待实现**：
- [ ] **版本保存**
  - 自动保存历史版本
  - 手动创建快照
  - 版本标签和说明
  
- [ ] **版本对比**
  - 并排对比视图
  - 高亮显示差异
  - 差异统计
  
- [ ] **版本回滚**
  - 回滚到指定版本
  - 部分回滚（仅回滚某些修改）
  - 回滚确认和警告

**数据结构**：
```typescript
interface PlanningVersion {
  id: string
  piId: string
  version: number
  snapshot: PlanningSnapshot
  createdAt: ISODate
  createdBy: string
  description?: string
  tags?: string[]
}
```

**验收标准**：
- 历史版本完整保存
- 对比视图清晰
- 回滚操作安全

---

### 3. 冲突检测和解决

**需求背景**：
- 复杂规划中容易出现冲突
- 需要自动检测各种冲突
- 需要提供解决方案

**待实现**：
- [ ] **冲突类型**
  - 容量冲突（超载）
  - 依赖冲突（依赖未满足）
  - 时间冲突（时间线不合理）
  - 资源冲突（人员冲突）
  
- [ ] **冲突检测**
  - 实时检测
  - 全局扫描
  - 冲突级别（警告/错误/严重）
  
- [ ] **解决建议**
  - 列出可能的解决方案
  - 评估每个方案的影响
  - 一键应用建议方案
  
- [ ] **冲突报告**
  - 冲突汇总列表
  - 冲突详情视图
  - 导出冲突报告

**UI设计**：
- 冲突图标和提示
- 冲突面板
- 冲突解决向导

**验收标准**：
- 能检测所有类型冲突
- 解决建议合理可行
- 冲突报告详细清晰

---

### 4. 权限控制

**需求背景**：
- 多用户协作需要权限控制
- 防止误操作
- 审计和追溯

**待实现**：
- [ ] **角色管理**
  - PI Planning Owner（全权限）
  - Team Lead（团队范围）
  - Team Member（只读/有限编辑）
  - Viewer（只读）
  
- [ ] **权限功能**
  - 页面访问权限
  - 操作权限（创建/编辑/删除）
  - 数据范围权限（只能操作自己团队）
  
- [ ] **锁定机制**
  - PI Planning锁定（阶段完成后锁定）
  - Sprint锁定（开始后锁定）
  - 编辑锁（同时只有一人编辑）
  
- [ ] **操作日志**
  - 记录所有操作
  - 操作人、时间、内容
  - 日志查询和导出

**验收标准**：
- 权限控制严格
- 锁定机制有效
- 操作日志完整

---

## 🔵 P3 - 扩展（高级功能）

### 1. 规划模板

**需求背景**：
- 相似的规划可以复用
- 加快规划速度

**待实现**：
- [ ] **模板管理**
  - 创建模板（基于现有规划）
  - 编辑模板
  - 删除模板
  
- [ ] **模板应用**
  - 基于模板创建新规划
  - 参数化模板（如团队数量、Sprint数量）
  - 部分应用模板
  
- [ ] **模板分享**
  - 模板库
  - 团队内分享
  - 模板评分和评论

**验收标准**：
- 模板易于创建和使用
- 参数化灵活
- 模板库内容丰富

---

### 2. 报表和分析

**需求背景**：
- 需要统计和分析规划数据
- 管理层需要报表

**待实现**：
- [ ] **统计报表**
  - PI规划统计（Feature/SSTS分配情况）
  - 团队容量利用率
  - 依赖关系统计
  - Sprint负载分布
  
- [ ] **分析图表**
  - 容量趋势图
  - 依赖关系图
  - 进度燃尽图
  - 团队对比图
  
- [ ] **导出报表**
  - PDF报表
  - Excel数据表
  - PPT展示文档

**技术方案**：
- 使用ECharts
- 使用jsPDF生成PDF
- 使用pptxgenjs生成PPT

**验收标准**：
- 报表数据准确
- 图表美观清晰
- 支持自定义报表

---

### 3. 协作功能

**需求背景**：
- 多人协同规划
- 实时沟通需求

**待实现**：
- [ ] **实时协作**
  - WebSocket实时同步
  - 显示其他用户的操作
  - 在线用户列表
  
- [ ] **评论讨论**
  - 对Feature/SSTS添加评论
  - @提及其他用户
  - 评论通知
  
- [ ] **变更通知**
  - 规划变更通知
  - 冲突提醒
  - 审批提醒

**技术方案**：
- WebSocket或Server-Sent Events
- 消息队列（Redis Pub/Sub）
- 通知中心

**验收标准**：
- 实时同步延迟 < 1s
- 评论系统完善
- 通知及时准确

---

### 4. 性能优化

**需求背景**：
- 大规模数据下性能问题
- 提升用户体验

**待实现**：
- [ ] **虚拟滚动**
  - 待分配列表虚拟滚动
  - 看板虚拟滚动
  - 支持1000+项
  
- [ ] **懒加载**
  - 按需加载数据
  - 图片懒加载
  - 组件懒加载
  
- [ ] **缓存策略**
  - 客户端缓存
  - Service Worker缓存
  - 接口缓存
  
- [ ] **性能监控**
  - 页面加载时间
  - 操作响应时间
  - 性能瓶颈分析

**技术方案**：
- 使用 `vue-virtual-scroller`
- Intersection Observer API
- IndexedDB缓存

**性能指标**：
- 首屏加载 < 2s
- 操作响应 < 100ms
- 支持1000+ Feature/SSTS

---

## 📝 任务优先级矩阵

| 任务                 | 优先级 | 工作量 | 价值 | 建议完成时间 |
| -------------------- | ------ | ------ | ---- | ------------ |
| 完善依赖检查         | P0     | 中     | 高   | 1周          |
| 数据完整性补充       | P0     | 中     | 高   | 1周          |
| 测试覆盖完善         | P0     | 大     | 高   | 2周          |
| 依赖关系可视化       | P1     | 大     | 高   | 2周          |
| 批量操作             | P1     | 中     | 高   | 1周          |
| 快捷键支持           | P1     | 小     | 中   | 3天          |
| 拖拽体验优化         | P1     | 中     | 中   | 1周          |
| 数据导出导入         | P1     | 中     | 高   | 1周          |
| 后端API集成          | P2     | 大     | 高   | 3周          |
| 规划历史管理         | P2     | 中     | 中   | 2周          |
| 冲突检测和解决       | P2     | 大     | 高   | 2周          |
| 权限控制             | P2     | 中     | 高   | 2周          |
| 规划模板             | P3     | 中     | 中   | 1周          |
| 报表和分析           | P3     | 大     | 中   | 2周          |
| 协作功能             | P3     | 大     | 高   | 3周          |
| 性能优化             | P3     | 中     | 中   | 持续         |

---

## 🎯 建议迭代计划

### Sprint 1（2周）
- [ ] 完善依赖检查逻辑
- [ ] 数据完整性补充
- [ ] 快捷键支持
- [ ] 批量操作（部分）

### Sprint 2（2周）
- [ ] 测试覆盖完善
- [ ] 拖拽体验优化
- [ ] 数据导出导入
- [ ] 批量操作（完成）

### Sprint 3（2周）
- [ ] 依赖关系可视化
- [ ] 后端API设计
- [ ] 冲突检测和解决（基础）

### Sprint 4-6（6周）
- [ ] 后端API集成
- [ ] 规划历史管理
- [ ] 权限控制
- [ ] 冲突检测和解决（完成）

### Sprint 7-9（6周）
- [ ] 规划模板
- [ ] 报表和分析
- [ ] 协作功能（基础）
- [ ] 性能优化

### 持续优化
- 性能监控和优化
- Bug修复
- 用户反馈处理

---

## ✅ 验收检查清单

### 功能完整性
- [ ] 所有P0任务完成
- [ ] 所有P1任务完成至少80%
- [ ] 核心功能测试通过

### 代码质量
- [ ] 代码审查通过
- [ ] 测试覆盖率 > 80%
- [ ] 无严重Bug

### 性能指标
- [ ] 页面加载时间 < 3s
- [ ] 操作响应时间 < 200ms
- [ ] 支持大规模数据（100+ Feature）

### 用户体验
- [ ] UI/UX设计评审通过
- [ ] 用户测试反馈良好
- [ ] 文档完整

---

## 📚 相关文档

- **实施报告**: `PI-PLANNING-2-STAGE-IMPLEMENTATION-REPORT.md`
- **设计文档**: `page-design/C3-规划协调/02-PI-Planning/C3-F18-PI-Planning-2阶段规划工作台.md`
- **API设计**: 待创建
- **测试计划**: 待创建

---

**文档维护**: 定期更新任务状态和优先级  
**反馈渠道**: 产品需求会议、用户反馈  
**更新周期**: 每2周
