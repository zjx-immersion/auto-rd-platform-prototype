# C3-F17: PI承诺

> **功能编号**: C3-F17  
> **功能名称**: PI承诺  
> **所属模块**: C3-规划协调  
> **优先级**: P1  
> **设计日期**: 2026-01-17

---

## 一、功能概述

### 1.1 功能定位

PI承诺是PI Planning的最后环节，团队正式承诺在PI周期内要完成的Feature和目标，并确认风险和依赖的缓解措施。

### 1.2 核心价值

- ✅ 明确团队PI承诺内容
- ✅ 确认承诺级别(必须/尽力/探索)
- ✅ 识别并记录承诺风险
- ✅ 建立承诺跟踪基线
- ✅ 支持承诺变更管理

### 1.3 用户角色

- **主要用户**: DL (Development Leader)
- **协作用户**: PM, TPM
- **审批用户**: 管理层

---

## 二、页面设计

### 2.1 PI承诺主页面

```
┌──────────────────────────────────────────────────────────────────────┐
│ Auto-RD平台 > PI 2024.4 > 团队承诺                   [保存] [提交承诺]│
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│ ┌─ PI信息 ─────────────────────────────────────────────────────┐   │
│ │ PI: 2024.4  版本: 2024.Q4  时间: 10周  团队: 智驾团队          │   │
│ │ DL: 张三  状态: 📝 待承诺                                      │   │
│ └────────────────────────────────────────────────────────────┘   │
│                                                                      │
│ ┌─ 承诺级别说明 ───────────────────────────────────────────────┐   │
│ │ ⭐ Committed (必须完成): 团队承诺在PI内完成                   │   │
│ │ 🎯 Stretch (尽力完成): 如果条件允许会尝试完成                │   │
│ │ 🔬 Exploratory (探索性): 技术探索,不承诺交付                  │   │
│ └────────────────────────────────────────────────────────────┘   │
│                                                                      │
│ ┌─ Feature承诺清单 ────────────────────────────────────────────┐   │
│ │                                                                  │   │
│ │ ⭐ Committed Features (必须完成) - 3个, 132 SP                  │   │
│ │ ├──────────────────────────────────────────────────────────┤   │   │
│ │ │ ✓ F-002: 自适应巡航增强 (55 SP)                            │   │   │
│ │ │   MR数量: 8个  容量占比: 41%  风险: 低                     │   │   │
│ │ │   Sprint分配: S1(21SP), S2(18SP), S3(16SP)                 │   │   │
│ │ │   依赖: 无外部依赖  负责DL: 张三                           │   │   │
│ │ │                                                              │   │   │
│ │ │ ✓ F-004: 车载地图优化 (43 SP)                              │   │   │
│ │ │   MR数量: 6个  容量占比: 33%  风险: 中                     │   │   │
│ │ │   Sprint分配: S1(15SP), S2(14SP), S3(14SP)                 │   │   │
│ │ │   依赖: 地图数据(外部,已确认)  负责DL: 李四               │   │   │
│ │ │                                                              │   │   │
│ │ │ ✓ F-011: 车道保持优化 (34 SP)                              │   │   │
│ │ │   MR数量: 5个  容量占比: 26%  风险: 低                     │   │   │
│ │ │   Sprint分配: S2(12SP), S3(11SP), S4(11SP)                 │   │   │
│ │ └──────────────────────────────────────────────────────────┤   │   │
│ │                                                                  │   │
│ │ 🎯 Stretch Features (尽力完成) - 1个, 28 SP                    │   │
│ │ ├──────────────────────────────────────────────────────────┤   │   │
│ │ │ ○ F-015: 夜间行车辅助 (28 SP)                              │   │   │
│ │ │   前提条件: Committed Features按计划完成                    │   │   │
│ │ │   Sprint分配: S4(28SP,条件性)                              │   │   │
│ │ │   风险: 高 - 取决于前序Feature完成情况                     │   │   │
│ │ └──────────────────────────────────────────────────────────┤   │   │
│ │                                                                  │   │
│ │ 🔬 Exploratory Features (探索性) - 1个                          │   │
│ │ ├──────────────────────────────────────────────────────────┤   │   │
│ │ │ ◯ F-020: AI驾驶模式研究 (Spike)                            │   │   │
│ │ │   目标: 可行性研究和原型验证,不承诺交付                    │   │   │
│ │ │   投入: 预留5%容量用于技术探索                             │   │   │
│ │ └──────────────────────────────────────────────────────────┤   │   │
│ │                                                                  │   │
│ │ 总计: 5个Feature, Committed 132SP (100%), Stretch 28SP (21%)   │   │
│ └────────────────────────────────────────────────────────────┘   │
│                                                                      │
│ ┌─ PI目标承诺 ─────────────────────────────────────────────────┐   │
│ │ ✓ 目标1: 用户体验提升 (权重40%) - 承诺达成                    │   │
│ │   成功指标3个全部承诺                                          │   │
│ │                                                                  │   │
│ │ ✓ 目标2: 系统稳定性提升 (权重30%) - 承诺达成                  │   │
│ │   成功指标2个全部承诺                                          │   │
│ │                                                                  │   │
│ │ ○ 目标3: 质量目标 (权重20%) - 部分承诺                        │   │
│ │   测试覆盖率承诺达到75%(目标80%),代码审查承诺95%+             │   │
│ │                                                                  │   │
│ │ ○ 目标4: 效能目标 (权重10%) - 尽力达成                        │   │
│ │   取决于前3个目标的达成情况                                    │   │
│ └────────────────────────────────────────────────────────────┘   │
│                                                                      │
│ ┌─ 容量和负载 ─────────────────────────────────────────────────┐   │
│ │ 团队总容量: 280 SP  已承诺: 132 SP  Stretch: 28 SP            │   │
│ │ Committed利用率: 47%  (建议40-60%)  ✓ 健康                    │   │
│ │ Committed+Stretch: 57%  (建议<70%)  ✓ 合理                    │   │
│ │                                                                  │   │
│ │ 按Sprint分配:                                                   │   │
│ │ S1: 36SP (51%)  S2: 44SP (63%)  S3: 41SP (59%)  S4: 39SP (56%) │   │
│ │ 负载较均衡 ✓                                                    │   │
│ └────────────────────────────────────────────────────────────┘   │
│                                                                      │
│ ┌─ 风险登记册 ─────────────────────────────────────────────────┐   │
│ │                                               [+ 添加风险]      │   │
│ │                                                                  │   │
│ │ ⚠️ R-01: 地图数据接口延期 (中等风险)                            │   │
│ │    影响: F-004可能延期1-2周                                     │   │
│ │    缓解措施: 与地图供应商建立周例会,提前2周预警                │   │
│ │    负责人: 李四  状态: 监控中                                  │   │
│ │                                                                  │   │
│ │ ⚠️ R-02: 关键成员休假 (低风险)                                  │   │
│ │    影响: S3期间有1周产能下降20%                                │   │
│ │    缓解措施: 提前培训备份人员,调整S3任务优先级                 │   │
│ │    负责人: 张三  状态: 已缓解                                  │   │
│ └────────────────────────────────────────────────────────────┘   │
│                                                                      │
│ ┌─ 依赖确认 ───────────────────────────────────────────────────┐   │
│ │ 外部依赖 (2个):                                                 │   │
│ │ ✓ 地图数据接口 - 供应商承诺10月底交付 (已书面确认)            │   │
│ │ ⚠️ 传感器固件升级 - 硬件团队承诺11月中交付 (存在风险)          │   │
│ │                                                                  │   │
│ │ 内部依赖 (1个):                                                 │   │
│ │ ✓ AI算法模型 - 算法团队已完成并验证                            │   │
│ └────────────────────────────────────────────────────────────┘   │
│                                                                      │
│ ┌─ 承诺健康度检查 ─────────────────────────────────────────────┐   │
│ │ 健康度评分: 85/100  (良好)                                      │   │
│ │                                                                  │   │
│ │ ✓ Committed容量合理 (40-60%)                                    │   │
│ │ ✓ Sprint负载均衡 (标准差<15%)                                   │   │
│ │ ✓ 所有Committed Feature有明确MR拆分                            │   │
│ │ ✓ 关键依赖已确认                                                │   │
│ │ ✓ 风险已识别并有缓解措施                                        │   │
│ │ ⚠️ 1个外部依赖存在延期风险                                      │   │
│ │                                                                  │   │
│ │ 建议: 可以提交承诺,但需密切监控外部依赖                        │   │
│ └────────────────────────────────────────────────────────────┘   │
│                                                                      │
│ ┌─ 承诺声明 ───────────────────────────────────────────────────┐   │
│ │ 我代表智驾团队承诺:                                             │   │
│ │ • 在PI 2024.4期间完成3个Committed Features (132 SP)            │   │
│ │ • 达成PI目标1和目标2                                            │   │
│ │ • 如条件允许,完成1个Stretch Feature (28 SP)                    │   │
│ │ • 积极管理已识别的2个风险                                       │   │
│ │ • 及时沟通进度和问题                                            │   │
│ │                                                                  │   │
│ │ 承诺人: [张三(DL)] ___________  日期: [2024-09-30] __________  │   │
│ │ 见证人: [李四(PM)] ___________  日期: [2024-09-30] __________  │   │
│ └────────────────────────────────────────────────────────────┘   │
│                                                                      │
│                                            [提交承诺] [保存草稿]    │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
```

---

## 三、数据模型

```typescript
interface PICommitment {
  id: string;
  piId: string;
  teamId: string;
  
  // Feature承诺
  committedFeatures: {
    featureId: string;
    level: 'committed' | 'stretch' | 'exploratory';
    storyPoints: number;
    mrCount: number;
    sprintAllocation: {sprintId: string, sp: number}[];
    risks: string[];
    dependencies: string[];
    owner: string;
  }[];
  
  // 目标承诺
  objectiveCommitments: {
    objectiveId: string;
    status: 'fully_committed' | 'partially_committed' | 'stretch';
    notes: string;
  }[];
  
  // 容量
  capacity: {
    totalCapacity: number;
    committedSP: number;
    stretchSP: number;
    utilizationRate: number;
    sprintDistribution: {sprintId: string, sp: number, rate: number}[];
  };
  
  // 风险
  risks: {
    id: string;
    title: string;
    severity: 'low' | 'medium' | 'high';
    impact: string;
    mitigation: string;
    owner: string;
    status: 'identified' | 'mitigating' | 'resolved';
  }[];
  
  // 依赖
  dependencies: {
    id: string;
    type: 'internal' | 'external';
    description: string;
    provider: string;
    expectedDate: Date;
    confirmed: boolean;
    risk: 'low' | 'medium' | 'high';
  }[];
  
  // 承诺声明
  statement: {
    content: string;
    committedBy: string;
    witnessedBy: string;
    date: Date;
  };
  
  // 健康度
  healthCheck: {
    score: number;
    checks: {name: string, passed: boolean, message: string}[];
  };
  
  // 状态
  status: 'draft' | 'submitted' | 'approved' | 'active';
  submittedAt?: Date;
  approvedAt?: Date;
}
```

---

## 四、API接口

```typescript
// 获取团队承诺
GET /api/pi/{piId}/teams/{teamId}/commitment

// 保存承诺草稿
POST /api/pi/{piId}/teams/{teamId}/commitment
PUT /api/commitments/{commitmentId}

// 提交承诺
POST /api/commitments/{commitmentId}/submit

// 健康度检查
GET /api/commitments/{commitmentId}/health-check

// 承诺变更申请
POST /api/commitments/{commitmentId}/change-request
```

---

## 五、业务规则

### 5.1 承诺级别定义

**Committed (必须完成)**:
- 团队有信心在PI内完成
- 容量已预留且合理(40-60%)
- 依赖已确认或可控
- 风险已识别且有缓解措施
- 承诺后原则上不能删减

**Stretch (尽力完成)**:
- 如果Committed按计划完成,会尝试
- 容量利用率可达60-70%
- 可能存在一定不确定性
- 不承诺一定完成

**Exploratory (探索性)**:
- 技术探索或可行性研究
- 不承诺具体交付物
- 通常占总容量<10%
- 关注学习和验证

### 5.2 容量建议

```
Committed: 40-60%  (预留40-60%缓冲应对不确定性)
Committed + Stretch: <70%  (避免过度承诺)
Exploratory: <10%  (预留少量创新空间)
```

### 5.3 承诺变更规则

**变更类型**:
1. **增加Committed**: 需PM审批,评估影响
2. **删除Committed**: 需管理层审批,说明原因
3. **Committed降级为Stretch**: 需PM审批
4. **Stretch升级为Committed**: DL可决定(容量允许)

**变更流程**:
```
申请 → 影响评估 → 审批 → 通知相关方 → 更新承诺
```

---

## 六、交互设计

### 6.1 拖拽调整承诺级别

- 拖拽Feature在Committed/Stretch/Exploratory区域间移动
- 实时更新容量利用率
- 超出建议范围时警告

### 6.2 健康度实时检查

**检查项**:
1. 容量合理性
2. Sprint负载均衡
3. Feature拆分完整性
4. 依赖确认状态
5. 风险缓解措施

**反馈**:
- 实时评分(0-100)
- 不通过项高亮显示
- 阻塞项不允许提交

### 6.3 承诺对比

- 显示初始规划 vs 最终承诺
- 高亮变化的Feature
- 说明调整原因

---

## 七、测试要点

- [x] Feature承诺级别设置
- [x] 容量计算和警告
- [x] 风险登记和缓解
- [x] 依赖确认状态
- [x] 健康度检查
- [x] 承诺提交和审批
- [x] 承诺变更流程
- [x] 并发提交冲突

---

**设计完成日期**: 2026-01-17  
**设计状态**: ✅ 已完成
