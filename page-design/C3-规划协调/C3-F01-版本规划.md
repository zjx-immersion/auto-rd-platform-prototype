# C3-F01: 版本规划

> **功能编号**: C3-F01
> **功能名称**: 版本规划
> **所属模块**: C3-规划协调
> **优先级**: P0 (核心功能)
> **设计日期**: 2025-01-15

---

## 一、功能概述

### 1.1 功能定位

版本规划是战略规划流程（P1）的最后一步，负责将Epic分配到具体的版本中，形成版本计划。

### 1.2 核心价值

- ✅ 将战略目标落地到具体版本
- ✅ 支持版本路线图规划
- ✅ 支持Epic-版本映射管理
- ✅ 支持版本容量评估
- ✅ 支持版本依赖管理

### 1.3 适用场景

- 产品经理进行版本规划
- 项目经理制定版本路线图
- 管理层查看版本计划

### 1.4 用户角色

- **主要用户**: PO (Product Owner)、PM (Product Manager)
- **次要用户**: TPM (Technical Program Manager)
- **查看用户**: 管理层、团队成员

---

## 二、页面设计

### 2.1 版本规划主页面

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ Auto-RD平台 > 规划协调 > 版本规划                                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 版本路线图                                    [+ 创建版本] [导出]    │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │                                                                     │   │
│  │  2025 Q1        2025 Q2        2025 Q3        2025 Q4              │   │
│  │  ├─────────────┼─────────────┼─────────────┼─────────────┤         │   │
│  │                                                                     │   │
│  │  V1.0          V1.1          V2.0          V2.1                    │   │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐           │   │
│  │  │ 2025-03  │  │ 2025-06  │  │ 2025-09  │  │ 2025-12  │           │   │
│  │  │ 5 Epics  │  │ 3 Epics  │  │ 4 Epics  │  │ 2 Epics  │           │   │
│  │  │ 进行中   │  │ 规划中   │  │ 规划中   │  │ 规划中   │           │   │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘           │   │
│  │                                                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 版本列表                                                             │   │
│  │ ┌───────────────────────────────────────────────────────────────┐  │   │
│  │ │ 筛选: [全部状态 ▼] [全部产品线 ▼] [搜索版本名称...]           │  │   │
│  │ └───────────────────────────────────────────────────────────────┘  │   │
│  │                                                                     │   │
│  │ ┌───────────────────────────────────────────────────────────────┐  │   │
│  │ │ 版本名称 │ 发布日期 │ Epic数 │ 状态   │ 进度  │ 操作      │  │   │
│  │ ├───────────────────────────────────────────────────────────────┤  │   │
│  │ │ V1.0     │ 2025-03  │ 5      │ 进行中 │ 60%   │ [详情]    │  │   │
│  │ │          │          │        │        │ ████░ │ [编辑]    │  │   │
│  │ ├───────────────────────────────────────────────────────────────┤  │   │
│  │ │ V1.1     │ 2025-06  │ 3      │ 规划中 │ 20%   │ [详情]    │  │   │
│  │ │          │          │        │        │ ██░░░ │ [编辑]    │  │   │
│  │ ├───────────────────────────────────────────────────────────────┤  │   │
│  │ │ V2.0     │ 2025-09  │ 4      │ 规划中 │ 10%   │ [详情]    │  │   │
│  │ │          │          │        │        │ █░░░░ │ [编辑]    │  │   │
│  │ ├───────────────────────────────────────────────────────────────┤  │   │
│  │ │ V2.1     │ 2025-12  │ 2      │ 规划中 │ 5%    │ [详情]    │  │   │
│  │ │          │          │        │        │ ░░░░░ │ [编辑]    │  │   │
│  │ └───────────────────────────────────────────────────────────────┘  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 统计信息                                                             │   │
│  │ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐               │   │
│  │ │ 总版本数 │ │ 进行中   │ │ 规划中   │ │ 已完成   │               │   │
│  │ │    4     │ │    1     │ │    3     │ │    0     │               │   │
│  │ └──────────┘ └──────────┘ └──────────┘ └──────────┘               │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 创建版本弹窗

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 创建版本                                                          [X]        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  版本名称: *                                                                 │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │ V1.0                                                                   │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  版本描述:                                                                   │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │ 首个正式版本，包含智能驾驶核心功能                                      │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  产品线: *                                                                   │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │ [智能驾驶系统 ▼]                                                       │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  计划发布日期: *                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │ [2025-03-31 📅]                                                        │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  版本类型: *                                                                 │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │ ● 主版本 (Major)  ○ 次版本 (Minor)  ○ 补丁版本 (Patch)                │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  版本目标 (OKR):                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │ Objective: 打造行业领先的L2+智能驾驶系统                                │ │
│  │                                                                        │ │
│  │ Key Results:                                                           │ │
│  │ ☑ KR1: 自动泊车功能上线，成功率≥90%                                    │ │
│  │ ☑ KR2: 自动跟车功能上线，用户满意度≥85%                                │ │
│  │ ☑ KR3: 通过ISO 26262 ASIL-B认证                                        │ │
│  │                                                                        │ │
│  │ [+ 添加Key Result]                                                     │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │ [取消]                                                    [创建版本]   │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---



### 2.3 版本详情页 - Epic分配

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ Auto-RD平台 > 规划协调 > 版本规划 > V1.0                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 版本信息                                                             │   │
│  │ ┌─────────────────────────────────────────────────────────────────┐ │   │
│  │ │ 版本名称: V1.0                                                   │ │   │
│  │ │ 产品线: 智能驾驶系统                                             │ │   │
│  │ │ 发布日期: 2025-03-31                                             │ │   │
│  │ │ 状态: 进行中                                                     │ │   │
│  │ │ 进度: 60% ████████████░░░░░░░░                                   │ │   │
│  │ └─────────────────────────────────────────────────────────────────┘ │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 版本目标 (OKR)                                                       │   │
│  │ ┌─────────────────────────────────────────────────────────────────┐ │   │
│  │ │ Objective: 打造行业领先的L2+智能驾驶系统                         │ │   │
│  │ │                                                                  │ │   │
│  │ │ Key Results:                                                     │ │   │
│  │ │ ☑ KR1: 自动泊车功能上线，成功率≥90%          [进度: 80%] ████░  │ │   │
│  │ │ ☑ KR2: 自动跟车功能上线，用户满意度≥85%      [进度: 60%] ███░░  │ │   │
│  │ │ ☐ KR3: 通过ISO 26262 ASIL-B认证              [进度: 40%] ██░░░  │ │   │
│  │ └─────────────────────────────────────────────────────────────────┘ │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ Epic分配                                          [+ 分配Epic]       │   │
│  │                                                                     │   │
│  │ ┌─────────────────────┐  ┌─────────────────────────────────────┐  │   │
│  │ │ 待分配Epic (8)       │  │ 已分配Epic (5)                      │  │   │
│  │ │                     │  │                                     │  │   │
│  │ │ 🔴 Must Have (3)    │  │ ┌─────────────────────────────────┐ │  │   │
│  │ │ ┌─────────────────┐ │  │ │ E001: 智能驾驶系统               │ │  │   │
│  │ │ │ E004: 车道保持  │ │  │ │ 优先级: 🔴 Must Have            │ │  │   │
│  │ │ │ 工作量: 40人天  │ │  │ │ 工作量: 80人天                  │ │  │   │
│  │ │ │ [分配到V1.0]    │ │  │ │ 进度: 80% ████████░░            │ │  │   │
│  │ │ └─────────────────┘ │  │ │ [查看详情] [移除]               │ │  │   │
│  │ │                     │  │ └─────────────────────────────────┘ │  │   │
│  │ │ 🟡 Should Have (3)  │  │                                     │  │   │
│  │ │ ┌─────────────────┐ │  │ ┌─────────────────────────────────┐ │  │   │
│  │ │ │ E006: 语音助手  │ │  │ │ E002: 自动泊车                   │ │  │   │
│  │ │ │ 工作量: 30人天  │ │  │ │ 优先级: 🔴 Must Have            │ │  │   │
│  │ │ │ [分配到V1.0]    │ │  │ │ 工作量: 60人天                  │ │  │   │
│  │ │ └─────────────────┘ │  │ │ 进度: 70% ███████░░░            │ │  │   │
│  │ │                     │  │ │ [查看详情] [移除]               │ │  │   │
│  │ │ 🟢 Could Have (2)   │  │ └─────────────────────────────────┘ │  │   │
│  │ │ ┌─────────────────┐ │  │                                     │  │   │
│  │ │ │ E008: 娱乐系统  │ │  │ ┌─────────────────────────────────┐ │  │   │
│  │ │ │ 工作量: 20人天  │ │  │ │ E003: 自动跟车                   │ │  │   │
│  │ │ │ [分配到V1.0]    │ │  │ │ 优先级: 🔴 Must Have            │ │  │   │
│  │ │ └─────────────────┘ │  │ │ 工作量: 50人天                  │ │  │   │
│  │ │                     │  │ │ 进度: 50% █████░░░░░            │ │  │   │
│  │ └─────────────────────┘  │ │ [查看详情] [移除]               │ │  │   │
│  │                          │ └─────────────────────────────────┘ │  │   │
│  │                          │                                     │  │   │
│  │                          │ ┌─────────────────────────────────┐ │  │   │
│  │                          │ │ E005: 碰撞预警                   │ │  │   │
│  │                          │ │ 优先级: 🟡 Should Have          │ │  │   │
│  │                          │ │ 工作量: 40人天                  │ │  │   │
│  │                          │ │ 进度: 30% ███░░░░░░░            │ │  │   │
│  │                          │ │ [查看详情] [移除]               │ │  │   │
│  │                          │ └─────────────────────────────────┘ │  │   │
│  │                          │                                     │  │   │
│  │                          │ ┌─────────────────────────────────┐ │  │   │
│  │                          │ │ E007: 疲劳监测                   │ │  │   │
│  │                          │ │ 优先级: 🟡 Should Have          │ │  │   │
│  │                          │ │ 工作量: 35人天                  │ │  │   │
│  │                          │ │ 进度: 20% ██░░░░░░░░            │ │  │   │
│  │                          │ │ [查看详情] [移除]               │ │  │   │
│  │                          │ └─────────────────────────────────┘ │  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 容量分析                                                             │   │
│  │ ┌─────────────────────────────────────────────────────────────────┐ │   │
│  │ │ 已分配工作量: 265人天                                            │ │   │
│  │ │ 版本容量: 300人天                                                │ │   │
│  │ │ 容量利用率: 88% ████████████████████░░                           │ │   │
│  │ │ ⚠️ 警告: 容量利用率已超过80%，建议调整Epic分配                   │ │   │
│  │ └─────────────────────────────────────────────────────────────────┘ │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 依赖关系图                                                           │   │
│  │ ┌─────────────────────────────────────────────────────────────────┐ │   │
│  │ │                                                                  │ │   │
│  │ │  E001 ──────┐                                                    │ │   │
│  │ │             ↓                                                    │ │   │
│  │ │  E002 ───→ E003                                                  │ │   │
│  │ │             ↓                                                    │ │   │
│  │ │  E005 ──────┘                                                    │ │   │
│  │ │                                                                  │ │   │
│  │ │  E007 (独立)                                                     │ │   │
│  │ │                                                                  │ │   │
│  │ │  说明: E001、E002、E005 → E003 (自动跟车依赖其他Epic)            │ │   │
│  │ └─────────────────────────────────────────────────────────────────┘ │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ [保存] [取消] [导出版本计划]                                         │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 六、数据模型

### 6.1 版本表 (Version)

```sql
CREATE TABLE version (
    version_id VARCHAR(50) PRIMARY KEY,
    version_name VARCHAR(100) NOT NULL,
    version_desc TEXT,
    product_line VARCHAR(100) NOT NULL,
    release_date DATE NOT NULL,
    version_type ENUM('Major', 'Minor', 'Patch') NOT NULL,
    status ENUM('Planning', 'InProgress', 'Released', 'Archived') DEFAULT 'Planning',
    objective TEXT,
    capacity INT DEFAULT 0,
    created_by VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY uk_version_name (product_line, version_name)
);
```

### 6.2 版本关键结果表 (Version_KeyResult)

```sql
CREATE TABLE version_key_result (
    kr_id VARCHAR(50) PRIMARY KEY,
    version_id VARCHAR(50) NOT NULL,
    kr_description TEXT NOT NULL,
    kr_target DECIMAL(10,2),
    kr_unit VARCHAR(20),
    kr_progress DECIMAL(5,2) DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (version_id) REFERENCES version(version_id)
);
```

### 6.3 Epic-版本映射表 (Epic_Version_Mapping)

```sql
CREATE TABLE epic_version_mapping (
    mapping_id VARCHAR(50) PRIMARY KEY,
    epic_id VARCHAR(50) NOT NULL,
    version_id VARCHAR(50) NOT NULL,
    assigned_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    assigned_by VARCHAR(50),
    FOREIGN KEY (epic_id) REFERENCES epic(epic_id),
    FOREIGN KEY (version_id) REFERENCES version(version_id),
    UNIQUE KEY uk_epic_version (epic_id, version_id)
);
```

---

## 七、API接口

### 7.1 创建版本

**接口**: `POST /api/v1/versions`

**请求体**:
```json
{
  "version_name": "V1.0",
  "version_desc": "首个正式版本",
  "product_line": "智能驾驶系统",
  "release_date": "2025-03-31",
  "version_type": "Major",
  "objective": "打造行业领先的L2+智能驾驶系统",
  "key_results": [
    {
      "kr_description": "自动泊车功能上线，成功率≥90%",
      "kr_target": 90,
      "kr_unit": "%"
    }
  ],
  "capacity": 300
}
```

**响应**:
```json
{
  "code": 200,
  "message": "版本创建成功",
  "data": {
    "version_id": "V-20250115-001",
    "version_name": "V1.0"
  }
}
```

### 7.2 分配Epic到版本

**接口**: `POST /api/v1/versions/{version_id}/epics`

**请求体**:
```json
{
  "epic_ids": ["E001", "E002", "E003"]
}
```

**响应**:
```json
{
  "code": 200,
  "message": "Epic分配成功",
  "data": {
    "assigned_count": 3,
    "capacity_utilization": 88
  }
}
```

### 7.3 获取版本详情

**接口**: `GET /api/v1/versions/{version_id}`

**响应**:
```json
{
  "code": 200,
  "data": {
    "version_id": "V-20250115-001",
    "version_name": "V1.0",
    "product_line": "智能驾驶系统",
    "release_date": "2025-03-31",
    "status": "InProgress",
    "progress": 60,
    "objective": "打造行业领先的L2+智能驾驶系统",
    "key_results": [...],
    "epics": [...],
    "capacity": 300,
    "estimated_effort": 265,
    "capacity_utilization": 88
  }
}
```

---

## 八、校验规则

### 8.1 版本创建校验

| 校验项 | 规则 | 错误提示 |
|-------|------|---------|
| 版本名称 | 不能为空，同一产品线下唯一 | "版本名称已存在" |
| 发布日期 | 必须晚于当前日期 | "发布日期必须晚于当前日期" |
| 版本类型 | 必须选择 | "请选择版本类型" |
| Key Results | 至少1个 | "至少需要1个关键结果" |

### 8.2 Epic分配校验

| 校验项 | 规则 | 错误提示 |
|-------|------|---------|
| Epic唯一性 | 一个Epic只能分配到一个版本 | "该Epic已分配到其他版本" |
| 容量限制 | 容量利用率≤100% | "版本容量已满，无法分配" |
| 容量预警 | 容量利用率>80% | "容量利用率已超过80%，建议调整" |
| 依赖检查 | 依赖的Epic应在同一版本或前序版本 | "存在依赖关系，建议调整分配" |

---

## 九、性能要求

### 9.1 响应时间

| 操作 | 目标响应时间 |
|-----|------------|
| 版本列表加载 | ≤1s |
| 版本详情加载 | ≤2s |
| 创建版本 | ≤3s |
| Epic分配 | ≤2s |
| 容量计算 | ≤1s |

### 9.2 并发支持

- 支持100+用户同时访问
- 支持10+用户同时编辑不同版本

---

## 十、测试用例

### 10.1 功能测试

| 用例ID | 测试场景 | 预期结果 |
|-------|---------|---------|
| TC-01 | 创建版本 | 版本创建成功，跳转到版本详情页 |
| TC-02 | 分配Epic | Epic分配成功，容量利用率更新 |
| TC-03 | 容量超限 | 显示容量预警，阻止分配 |
| TC-04 | 依赖检查 | 显示依赖关系，提示调整 |
| TC-05 | 版本编辑 | 版本信息更新成功 |

### 10.2 边界测试

| 用例ID | 测试场景 | 预期结果 |
|-------|---------|---------|
| TC-06 | 版本名称重复 | 提示"版本名称已存在" |
| TC-07 | 发布日期早于当前日期 | 提示"发布日期必须晚于当前日期" |
| TC-08 | 容量利用率100% | 阻止继续分配Epic |
| TC-09 | 无Key Result | 提示"至少需要1个关键结果" |

---

## 十一、后续优化

### 11.1 短期优化

1. **版本对比功能**: 支持多个版本的对比分析
2. **版本克隆功能**: 支持从已有版本克隆创建新版本
3. **版本模板**: 提供常用版本模板

### 11.2 长期优化

1. **智能推荐**: 基于历史数据推荐Epic分配
2. **容量预测**: 基于团队速率预测版本容量
3. **风险预警**: 自动识别版本风险并预警

---

**设计完成日期**: 2025-01-15
**设计人**: 平台架构组
**审核状态**: 待审核

