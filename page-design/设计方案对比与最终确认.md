# 设计方案对比与最终确认

> **创建日期**: 2026-01-17  
> **目的**: 对比V1.0和V2.0设计方案，明确最终实施方案

---

## 📊 方案对比

| 维度 | V1.0 (差距分析方案) | V2.0 (完整设计方案) | 推荐 |
|------|-------------------|-------------------|------|
| **设计深度** | 问题分析 + 解决方案 | 系统化设计 + 价值流 + 领域模型 | **V2.0** |
| **PRD管理** | 仅在线编辑 | 在线编辑 + 上传文档 | **V2.0** |
| **评审流程** | PRD+SSTS一起评审 | PRD独立评审、SSTS批量评审（可查看PRD） | **V2.0** |
| **Epic管理** | 简单的只读控制 | 需求池完整设计（编辑、变更、评审） | **V2.0** |
| **流程驱动** | 基础流程导航 | 完整流程引擎 + 多流程支持 | **V2.0** |
| **范围控制** | 复杂的多维度 | 简化的4层范围（项目>PI>Sprint>团队） | **V2.0** |
| **价值流** | 未涉及 | 完整的价值流地图 + 指标体系 | **V2.0** |
| **领域模型** | 未系统化 | 清晰的5大领域划分 | **V2.0** |
| **工作量** | 8.5-10.5天 | 12天 | V2.0（更完整） |

---

## ✅ V2.0核心优势

### 1. 系统化设计理念

**V2.0采用四大核心原则**:
```
价值流驱动 ──┐
领域模型   ──┼──> 高效透明的研发平台
流程协同   ──┤
范围控制   ──┘
```

**V1.0**:
- 从问题出发，针对性解决
- 缺少整体架构和理念

**V2.0**:
- 从价值流出发，系统化设计
- 清晰的架构和理念
- 可度量的效能指标

### 2. PRD管理更灵活

**V1.0**: 
```
只支持在线编辑
```

**V2.0**:
```typescript
interface PRD {
  type: 'online' | 'uploaded';
  
  // 在线文档
  content?: string;
  markdown?: string;
  
  // 上传文档
  fileUrl?: string;
  fileName?: string;
  fileType?: 'pdf' | 'word' | 'markdown';
}
```

**优势**:
- ✅ 适应不同团队的工作习惯
- ✅ 支持已有PRD文档的导入
- ✅ 在线编辑和上传文档可以并存

### 3. 评审流程更合理

**V1.0**: 
```
PRD+SSTS批量评审（一起评审）
```

**V2.0**:
```
1. PRD独立评审 (/function/c1/feature/:id/prd/review)
   - 专注PRD内容的评审
   - 评审通过后才能拆解SSTS

2. SSTS批量评审 (/function/c1/feature/:id/ssts/batch-review)
   - 可以同时评审多个SSTS
   - 左侧30%显示PRD（只读，供参考）
   - 右侧70%显示SSTS列表（可展开、批量勾选）
```

**优势**:
- ✅ 评审职责更清晰
- ✅ 评审流程更灵活
- ✅ 在评审SSTS时可以方便查看PRD上下文

### 4. 需求池完整设计

**V1.0**: 
```
简单的Epic只读控制：
- 来自需求池的Epic在项目中只读
- 提供"在需求池中编辑"跳转
```

**V2.0**:
```typescript
interface RequirementPool {
  id: string;
  name: string;
  epics: Epic[];
  reviewConfig: {...};
  stats: {...};
}

interface Epic {
  // 来源和状态
  source: 'requirement_pool' | 'manual';
  status: 'draft' | 'pending_review' | 'approved' | 'rejected' | 'in_project';
  
  // 变更管理
  changes: Change[];
  currentVersion: number;
  
  // 项目关联
  projects: string[];
  isReadOnlyInProject: boolean;
}

// 页面
/function/requirement-pool              # 需求池主页
/function/requirement-pool/epic/create   # 创建Epic
/function/requirement-pool/epic/:id/edit # 编辑Epic
/function/requirement-pool/epic/:id/review # Epic评审
/function/requirement-pool/epic/:id/change # 发起变更
```

**优势**:
- ✅ 需求池作为Epic的源头，统一管理
- ✅ 完整的Epic生命周期（创建→评审→导入→变更）
- ✅ 版本管理和变更追踪
- ✅ Epic在项目中只读，保证一致性

### 5. 流程引擎架构

**V1.0**: 
```
基础的流程导航：
- 流程模板定义
- 流程实例管理
- 流程进度显示
```

**V2.0**:
```typescript
// 完整的流程引擎
interface ProcessEngine {
  // 流程定义
  definitions: ProcessDefinition[];
  
  // 流程实例
  instances: ProcessInstance[];
  
  // 流程引擎
  start(definitionId, scope): ProcessInstance;
  pause(instanceId): void;
  resume(instanceId): void;
  complete(instanceId): void;
  
  // 步骤管理
  goToStep(instanceId, stepId): void;
  skipStep(instanceId, stepId): void;
  
  // 上下文管理
  getContext(instanceId): Record<string, any>;
  setContext(instanceId, data): void;
}

// 预定义流程
1. PI Planning流程（10步）
2. 需求拆解流程（7步）
3. Sprint规划流程（7步）
4. 发布流程（待定义）
5. 测试验证流程（待定义）
```

**优势**:
- ✅ 完整的流程引擎基础设施
- ✅ 支持流程定义的版本管理
- ✅ 流程上下文数据传递
- ✅ 流程历史追踪
- ✅ 易于扩展新流程

### 6. 范围控制简化

**V1.0**: 
```
复杂的多维度范围：
- 项目范围
- PI范围
- Sprint范围
- 团队范围
- 产品范围
- 模块范围
... (过于复杂)
```

**V2.0**:
```
简化的4层范围 + 特殊维度：

核心4层（层次关系）:
L1: 项目 (DomainProject)
    └─ 适用于: 项目规划、需求拆解、进度管理
L2: PI (Program Increment)
    └─ 适用于: PI Planning、Feature分配、依赖管理
L3: 迭代 (Sprint)
    └─ 适用于: Backlog规划、Task分配、日常执行
L4: 团队 (Team)
    └─ 适用于: 团队Backlog、人员分工、团队度量

特殊维度（过滤器）:
- 产品过滤: 在需求页面按产品过滤Feature
- 模块过滤: 在需求页面按模块团队过滤MR
```

**优势**:
- ✅ 层次清晰，易于理解
- ✅ 符合实际工作流程
- ✅ 不涉及复杂的数据权限
- ✅ 特殊需求用过滤器解决

### 7. 价值流设计

**V1.0**: 
```
未涉及价值流概念
```

**V2.0**:
```mermaid
graph LR
    A[客户需求] --> B[Epic评审]
    B --> C[Feature拆解]
    C --> D[PRD编写]
    D --> E[SSTS拆解]
    E --> F[Feature分配]
    F --> G[PI Planning]
    G --> H[Sprint规划]
    H --> I[开发实现]
    I --> J[测试验证]
    J --> K[发布交付]
    K --> L[交付客户]
```

**关键指标**:
- Epic评审周期: ≤3天
- PRD编写周期: ≤5天
- PI Planning周期: ≤2天
- 前置时间: ≤30天
- 流动效率: ≥40%
- Sprint速率稳定性: 变异系数≤20%

**优势**:
- ✅ 端到端的价值流可视化
- ✅ 可度量的效能指标
- ✅ 识别瓶颈和优化点
- ✅ 持续改进的基础

### 8. 领域模型设计

**V1.0**: 
```
未系统化的领域划分
```

**V2.0**:
```
5大领域:

需求域 (Requirement Domain)
  ├─ RequirementPool
  ├─ Epic
  ├─ Feature
  ├─ PRD
  ├─ SSTS
  └─ MR

规划域 (Planning Domain)
  ├─ DomainProject
  ├─ Version
  ├─ PI
  └─ Sprint

执行域 (Execution Domain)
  ├─ Backlog
  ├─ Task
  └─ WorkItem

资产域 (Asset Domain)
  ├─ ProductLine
  ├─ Product
  ├─ Module
  └─ Asset

质量域 (Quality Domain)
  ├─ TestCase
  ├─ Defect
  └─ Verification
```

**优势**:
- ✅ 清晰的业务边界
- ✅ 易于理解和维护
- ✅ 支持未来扩展
- ✅ 符合DDD（领域驱动设计）原则

---

## 🎯 最终推荐方案

### **推荐：V2.0 平台完整设计方案**

**理由**:
1. ✅ 更系统化的设计理念
2. ✅ 更完整的功能覆盖
3. ✅ 更合理的评审流程
4. ✅ 更灵活的PRD管理
5. ✅ 更清晰的领域模型
6. ✅ 更强大的流程引擎
7. ✅ 更简化的范围控制
8. ✅ 包含价值流设计和指标体系

**工作量差异**:
- V1.0: 8.5-10.5天
- V2.0: 12天
- 差异: +1.5~3.5天

**额外投入的价值**:
- 需求池完整设计（+2天）
- 流程引擎架构（+2天）
- 价值流和领域模型设计（已包含在设计中）

**值得额外投入，因为**:
- 避免未来返工
- 提供更完整的解决方案
- 建立可扩展的架构
- 支持持续改进

---

## 📋 实施计划（基于V2.0）

### Phase 1: 核心基础（P0） - 5天 🔥

#### Day 1-2: PRD管理
**目标**: 完成PRD在线编辑和上传功能

- [x] PRD数据模型（online + uploaded）
- [x] TipTap富文本编辑器集成
- [x] PRD在线编辑页面
- [x] PRD上传页面
- [x] 自动保存（2秒防抖）
- [x] 草稿管理
- [x] PRD模板管理（5+个模板）
- [x] 版本历史（查看、对比、恢复）

**验收标准**:
- PRD编辑器加载 < 1秒
- 自动保存响应 < 500ms
- 支持在线编辑和上传两种方式
- 版本对比清晰直观

#### Day 3: 评审流程
**目标**: 完成PRD独立评审和SSTS批量评审

- [x] 评审引擎基础设施
- [x] 评审数据模型（ReviewStatus, Review）
- [x] PRD独立评审页面
- [x] SSTS批量评审页面（左侧PRD参考，右侧SSTS列表）
- [x] 评审状态管理
- [x] 评审意见列表
- [x] 评审通知

**验收标准**:
- PRD评审和SSTS评审独立进行
- SSTS评审时可方便查看PRD
- 评审意见清晰可追溯
- 评审通知及时

#### Day 4-5: Feature分配
**目标**: 完成Feature批量分配到PI/团队功能

- [x] Feature分配页面（时间线视图）
- [x] 拖拽功能（@dnd-kit/core）
- [x] Feature池（左侧30%）
- [x] PI分配视图（右侧70%，团队/Sprint/时间线三种视图）
- [x] 容量可视化（进度条、百分比）
- [x] 冲突检测（依赖冲突、容量超限）
- [x] 批量操作（批量分配、取消分配）

**验收标准**:
- 拖拽响应 < 100ms
- 支持100+Feature的拖拽
- 容量可视化清晰
- 冲突检测准确（依赖、容量）

---

### Phase 2: 需求池与流程（P1） - 4天

#### Day 6-7: 需求池
**目标**: 完成需求池和Epic管理功能

- [ ] 需求池数据模型（RequirementPool, Epic, Change）
- [ ] 需求池主页
- [ ] Epic创建和编辑页面
- [ ] Epic评审流程
- [ ] Epic变更管理
- [ ] Epic导入到项目（标记只读）
- [ ] 需求池统计和看板

**验收标准**:
- Epic在需求池中可编辑
- Epic评审流程完整
- Epic导入到项目后只读
- 变更历史可追溯

#### Day 8-9: 流程引擎
**目标**: 完成流程引擎基础设施和流程模板

- [ ] 流程引擎数据模型（ProcessDefinition, ProcessInstance, ProcessStep）
- [ ] 流程引擎实现（start, pause, resume, complete）
- [ ] 流程定义管理
- [ ] 流程实例管理
- [ ] 流程导航UI（流程列表、流程执行页、流程详情页）
- [ ] PI Planning流程模板（10步）
- [ ] 需求拆解流程模板（7步）
- [ ] Sprint规划流程模板（7步）

**验收标准**:
- 流程可启动、暂停、恢复、完成
- 流程进度可视化
- 流程步骤导航清晰
- 流程上下文数据传递正确
- 至少3个流程模板可用

---

### Phase 3: 范围与团队（P1） - 3天

#### Day 10: 范围控制
**目标**: 完成范围选择器和数据自动过滤

- [ ] 范围上下文数据模型（ScopeContext, Scope）
- [ ] 范围选择器UI（顶部导航栏）
- [ ] 范围层次管理（项目>PI>Sprint>团队）
- [ ] Store中数据自动过滤逻辑
- [ ] 需求页面产品/模块过滤器
- [ ] 范围切换状态保持

**验收标准**:
- 范围选择器易用
- 数据自动根据范围过滤
- 范围切换 < 2秒
- 需求页面特殊过滤正确

#### Day 11-12: 团队工作台
**目标**: 完成团队工作台和模块需求管理

- [ ] 团队工作台首页
- [ ] 团队Backlog管理
- [ ] 模块需求管理页面（团队视角）
- [ ] 模块选择器（团队负责的1-n个模块）
- [ ] SSTS拆解为MR功能
- [ ] 批量操作（评审、分配、状态更新）
- [ ] 看板视图（按状态分组）

**验收标准**:
- 团队只看到自己负责模块的MR
- SSTS拆解为MR流程顺畅
- 批量操作高效
- 看板视图直观

---

## 🎯 关键决策点

### 决策1: 使用V2.0方案？

**建议**: ✅ **是**

**理由**:
- V2.0更系统化、更完整
- 额外投入1.5-3.5天是值得的
- 避免未来返工
- 建立可扩展的架构

### 决策2: PRD管理方式

**V2.0方案**: 在线编辑 + 上传文档

**建议**: ✅ **采纳**

**理由**:
- 适应不同团队习惯
- 支持已有PRD导入
- 灵活性高

### 决策3: 评审流程

**V2.0方案**: PRD独立评审、SSTS批量评审（可查看PRD）

**建议**: ✅ **采纳**

**理由**:
- 评审职责更清晰
- 评审流程更灵活
- 在评审SSTS时可方便查看PRD上下文

### 决策4: 需求池设计

**V2.0方案**: 完整的需求池设计（Epic创建、编辑、评审、变更、导入）

**建议**: ✅ **采纳**

**理由**:
- Epic管理更规范
- 需求池作为Epic源头
- 支持变更追踪
- Epic在项目中只读保证一致性

### 决策5: 流程引擎

**V2.0方案**: 完整的流程引擎架构

**建议**: ✅ **采纳**

**理由**:
- 支持多流程协同
- 易于扩展新流程
- 流程上下文数据传递
- 流程历史追踪

### 决策6: 范围控制

**V2.0方案**: 简化的4层范围（项目>PI>Sprint>团队）

**建议**: ✅ **采纳**

**理由**:
- 层次清晰
- 符合实际工作流程
- 不涉及复杂数据权限
- 特殊需求用过滤器解决

---

## ✅ 最终确认

### 采用方案

**V2.0 平台完整设计方案 - 基于价值流、领域模型与流程协同**

### 实施时间

**总工作量**: 12天（2026-01-18 ~ 2026-01-31）

- Phase 1: 5天（P0，2026-01-18~22）
- Phase 2: 4天（P1，2026-01-23~26）
- Phase 3: 3天（P1，2026-01-27~29）
- Buffer: 2天（2026-01-30~31，处理问题和优化）

### 下一步行动

1. ✅ **立即**: 确认V2.0方案（等待用户确认）
2. ⏳ **Day 1**: 开始Phase 1实施（PRD管理）
3. ⏳ **每天**: 进度跟踪和问题解决
4. ⏳ **每个Phase结束**: 验收和调整

---

**文档版本**: V1.0  
**最后更新**: 2026-01-17  
**状态**: 待用户确认  
**推荐方案**: V2.0
