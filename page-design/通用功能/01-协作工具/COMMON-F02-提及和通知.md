# COMMON-F02 @提及和通知

> **功能编号**: COMMON-F02  
> **功能名称**: @提及和通知  
> **所属能力域**: 通用功能  
> **主要用户**: 所有用户  
> **页面类型**: 通用组件 + 通知中心

---

## 一、功能概述

### 1.1 功能定位
@提及和通知功能支持在评论、评审意见等场景中@提及用户，并自动发送通知，用户可以在通知中心查看和管理通知。

### 1.2 核心价值
- **及时通知**: 及时通知相关人员
- **协作效率**: 提升团队协作效率
- **信息同步**: 确保信息同步
- **任务跟踪**: 跟踪需要关注的事项

### 1.3 通知流程

```mermaid
graph LR
    A[@提及用户] --> B[生成通知]
    B --> C[通知中心]
    C --> D[用户查看]
    D --> E[标记已读]
    E --> F[处理通知]
```

---

## 二、页面布局

### 2.1 @提及输入组件

```
┌─────────────────────────────────────────────────────────────┐
│ @提及输入组件 (@MentionInput)                                │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│                                                             │
│ [输入框] 输入@后显示用户列表                                │
│                                                             │
│ 当输入@时，显示用户下拉列表:                                │
│ ┌─────────────────────────────────────────────────────────┐│
│ │ @ 张伟 (PO)                                             ││
│ │ @ 李娜 (PM)                                             ││
│ │ @ 王五 (SE)                                             ││
│ │ @ 赵六 (SO)                                             ││
│ └─────────────────────────────────────────────────────────┘│
│                                                             │
│ 已选择的用户显示为标签:                                     │
│ [@张伟] [@李娜] 输入内容...                                 │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 通知中心页面

```
┌─────────────────────────────────────────────────────────────┐
│ 面包屑导航: 工作区 > 通知中心                                │
├─────────────────────────────────────────────────────────────┤
│ 页面标题: 通知中心                                          │
│ [全部标记为已读] [筛选] [设置]                             │
├─────────────────────────────────────────────────────────────┤
│ 筛选栏                                                      │
│ ┌─────────────────────────────────────────────────────────┐│
│ │ 类型: [全部 ▼]  状态: [全部 ▼]  时间: [全部 ▼]        ││
│ │ 关键词: [搜索...]                                       ││
│ └─────────────────────────────────────────────────────────┘│
├─────────────────────────────────────────────────────────────┤
│ 通知列表                                                    │
│ ┌─────────────────────────────────────────────────────────┐│
│ │ 🔴 [未读] @提及                                         ││
│ │ 👤 张伟 在 Feature ADAS-F001 的评论中提到了你          ││
│ │ "这个Feature需要你的评审意见 @李娜"                     ││
│ │ 2小时前  [查看] [标记已读]                              ││
│ │ ─────────────────────────────────────────────────────── ││
│ │                                                         ││
│ │ ⚪ [已读] 评论                                           ││
│ │ 👤 王五 回复了你在 Epic ADAS-E001 的评论                ││
│ │ "同意你的观点，已纳入计划。"                            ││
│ │ 5小时前  [查看] [删除]                                 ││
│ │ ─────────────────────────────────────────────────────── ││
│ │                                                         ││
│ │ 🔴 [未读] 评审                                           ││
│ │ 👤 张伟 提交了 Feature ADAS-F001 的评审，需要你的评审  ││
│ │ 评审结果: 待评审                                        ││
│ │ 1天前  [查看] [标记已读]                                ││
│ │ ─────────────────────────────────────────────────────── ││
│ │                                                         ││
│ │ ⚪ [已读] 状态变更                                       ││
│ │ Feature ADAS-F001 状态变更为"进行中"                    ││
│ │ 2天前  [查看] [删除]                                    ││
│ └─────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────┘
```

---

## 三、数据字段

### 3.1 通知字段

| 字段名 | 字段类型 | 说明 |
|--------|---------|------|
| id | String | 通知ID |
| type | Enum | 通知类型: mention/comment/review/status-change/assignment |
| title | String | 通知标题 |
| content | String | 通知内容 |
| entityType | Enum | 实体类型: epic/feature/ssts/mr/task |
| entityId | String | 实体ID |
| entityName | String | 实体名称 |
| sender | User | 发送者 |
| receiver | User | 接收者 |
| read | Boolean | 是否已读 |
| readAt | DateTime | 已读时间 |
| actionUrl | String | 操作链接 |
| createdAt | DateTime | 创建时间 |

### 3.2 通知类型

| 类型 | 说明 | 触发场景 |
|------|------|---------|
| mention | @提及 | 在评论中@提及用户 |
| comment | 评论 | 回复评论、新评论 |
| review | 评审 | 提交评审、评审结果 |
| status-change | 状态变更 | 实体状态变更 |
| assignment | 分配 | 分配任务、分配负责人 |

---

## 四、交互设计

### 4.1 @提及输入

- **自动补全**: 输入@后自动显示用户列表
- **用户搜索**: 支持搜索用户
- **用户选择**: 点击用户或按Enter选择
- **标签显示**: 选择的用户显示为标签
- **标签删除**: 点击标签删除@提及

### 4.2 通知中心

- **未读标记**: 未读通知显示红色标记
- **类型筛选**: 按通知类型筛选
- **状态筛选**: 按已读/未读筛选
- **时间筛选**: 按时间范围筛选
- **批量操作**: 支持批量标记已读、批量删除
- **跳转**: 点击通知跳转到相关页面

### 4.3 通知设置

- **通知偏好**: 设置通知类型偏好
- **邮件通知**: 设置是否发送邮件通知
- **推送通知**: 设置是否推送通知

---

## 五、API接口

### 5.1 获取通知列表

**请求**:
```http
GET /api/v1/notifications?type=&read=&page=1&pageSize=20
```

**响应**:
```json
{
  "code": 200,
  "data": {
    "notifications": [
      {
        "id": "notif-001",
        "type": "mention",
        "title": "@提及",
        "content": "张伟 在 Feature ADAS-F001 的评论中提到了你",
        "entityType": "feature",
        "entityId": "feature-001",
        "entityName": "ADAS-F001",
        "sender": {
          "id": "user-001",
          "name": "张伟"
        },
        "read": false,
        "actionUrl": "/function/c1-requirement/feature/feature-001#comments",
        "createdAt": "2025-01-15T10:00:00Z"
      }
    ],
    "total": 15,
    "unreadCount": 5,
    "page": 1,
    "pageSize": 20
  }
}
```

### 5.2 标记通知已读

**请求**:
```http
PATCH /api/v1/notifications/{notificationId}/read
```

### 5.3 批量标记已读

**请求**:
```http
PATCH /api/v1/notifications/read-all
```

---

## 六、集成位置

### 6.1 评论组件
- 在评论输入框中集成@提及功能

### 6.2 评审组件
- 在评审意见输入框中集成@提及功能

### 6.3 导航栏
- 在导航栏显示未读通知数量
- 点击跳转到通知中心

---

**设计版本**: V1.0  
**最后更新**: 2026-01-17
