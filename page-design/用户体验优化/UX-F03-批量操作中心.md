# UX-F03 批量操作中心

> **功能编号**: UX-F03  
> **功能名称**: 批量操作中心  
> **所属能力域**: 用户体验优化  
> **主要用户**: PM、PO、SE、DL  
> **页面类型**: 通用组件

---

## 一、功能概述

### 1.1 功能定位
批量操作中心是在列表页提供的批量处理功能，支持批量选择、批量操作和操作预览，大幅提升批量处理效率。

### 1.2 核心价值
- **提升效率**: 减少70%的重复操作
- **批量处理**: 支持复杂批量操作
- **操作安全**: 操作预览和确认机制
- **灵活选择**: 支持多种选择方式

### 1.3 使用场景

| 场景 | 用户操作 | 批量操作 |
|------|---------|---------|
| Epic列表页 | 选择多个Epic | 批量分配到版本、批量变更状态、批量导出 |
| Feature列表页 | 选择多个Feature | 批量分配到PI、批量变更优先级、批量评审 |
| Task列表页 | 选择多个Task | 批量分配到Sprint、批量变更负责人、批量估算工时 |
| Sprint列表页 | 选择多个Sprint | 批量变更状态、批量生成报告 |

---

## 二、页面布局

### 2.1 列表页集成

```
┌─────────────────────────────────────────────────────────────┐
│ Epic列表页                                                  │
├─────────────────────────────────────────────────────────────┤
│ [筛选] [搜索] [批量操作 ▼] [导出] [刷新]                   │
├─────────────────────────────────────────────────────────────┤
│ ☑ 全选  [已选择 3 项] [批量操作 ▼]                        │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│                                                             │
│ ☑ Epic编码    Epic名称        状态    进度    操作        │
│ ─────────────────────────────────────────────────────────── │
│ ☑ ADAS-E001   智能驾驶辅助系统  进行中  40%   [详情]      │
│ ☑ ADAS-E002   自动泊车系统      待开始  0%    [详情]      │
│ ☐ ADAS-E003   智能座舱系统      已批准  0%    [详情]      │
│ ☑ ADAS-E004   车联网系统        进行中  25%   [详情]      │
│                                                             │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│ 批量操作工具栏 (固定在底部)                                │
│ ┌─────────────────────────────────────────────────────────┐│
│ │ 已选择 3 项                                              ││
│ │ [批量分配到版本] [批量变更状态] [批量导出] [取消选择]  ││
│ └─────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────┘
```

### 2.2 批量操作对话框

```
┌─────────────────────────────────────────────────────────────┐
│ 批量操作 - 分配到版本                                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ 操作类型: 批量分配到版本                                    │
│ 选择数量: 3个Epic                                          │
│                                                             │
│ 操作预览:                                                   │
│ ┌─────────────────────────────────────────────────────────┐│
│ │ Epic列表:                                               ││
│ │ • ADAS-E001 智能驾驶辅助系统                            ││
│ │ • ADAS-E002 自动泊车系统                                ││
│ │ • ADAS-E004 车联网系统                                  ││
│ │                                                         ││
│ │ 目标版本: [Version 2025-Q1 ▼]                          ││
│ │                                                         ││
│ │ 影响范围:                                               ││
│ │ • 将影响 5个Feature                                     ││
│ │ • 将影响 2个PI规划                                      ││
│ └─────────────────────────────────────────────────────────┘│
│                                                             │
│ [取消] [确认操作]                                          │
└─────────────────────────────────────────────────────────────┘
```

---

## 三、数据字段

### 3.1 批量选择字段

| 字段名 | 字段类型 | 说明 |
|--------|---------|------|
| selectedIds | Array<String> | 选中的实体ID列表 |
| selectedCount | Number | 选中数量 |
| totalCount | Number | 总数量 |
| selectionMode | Enum | 选择模式: single/multiple |

### 3.2 批量操作字段

| 字段名 | 字段类型 | 说明 |
|--------|---------|------|
| operationType | Enum | 操作类型: assign/status-change/export/review |
| targetType | Enum | 目标类型: version/pi/sprint/user/status |
| targetValue | String | 目标值 |
| affectedEntities | Array<Entity> | 受影响的实体列表 |
| operationPreview | Object | 操作预览信息 |

### 3.3 操作结果字段

| 字段名 | 字段类型 | 说明 |
|--------|---------|------|
| successCount | Number | 成功数量 |
| failureCount | Number | 失败数量 |
| successItems | Array<String> | 成功项ID列表 |
| failureItems | Array<Object> | 失败项列表（ID + 原因） |

---

## 四、交互设计

### 4.1 选择方式

- **单选**: 点击复选框选择单个实体
- **全选**: 点击表头复选框全选/取消全选
- **条件选择**: 根据筛选条件批量选择
- **保存选择**: 保存当前选择，刷新后仍保留

### 4.2 批量操作类型

| 操作类型 | 适用实体 | 操作内容 |
|---------|---------|---------|
| 批量分配 | Epic/Feature/Task | 分配到版本/PI/Sprint |
| 批量状态变更 | Epic/Feature/SSTS/MR/Task | 批量变更状态 |
| 批量分配负责人 | Task/MR | 批量分配负责人 |
| 批量评审 | Epic/Feature/SSTS/MR | 批量发起评审 |
| 批量导出 | 所有实体 | 批量导出数据 |
| 批量删除 | Epic/Feature/SSTS/MR | 批量删除（需确认） |

### 4.3 操作预览

- **影响范围分析**: 显示操作影响的实体数量
- **冲突检测**: 检测操作冲突并提示
- **操作结果预览**: 预览操作后的状态

### 4.4 操作确认

- **确认对话框**: 重要操作需要确认
- **操作日志**: 记录批量操作日志
- **回滚支持**: 支持批量操作回滚（部分操作）

---

## 五、API接口

### 5.1 批量操作

**请求**:
```http
POST /api/v1/batch-operations
Content-Type: application/json

{
  "operationType": "assign",
  "entityType": "epic",
  "entityIds": ["epic-001", "epic-002", "epic-004"],
  "targetType": "version",
  "targetValue": "version-2025-q1"
}
```

**响应**:
```json
{
  "code": 200,
  "data": {
    "operationId": "batch-op-001",
    "successCount": 3,
    "failureCount": 0,
    "successItems": ["epic-001", "epic-002", "epic-004"],
    "failureItems": []
  }
}
```

### 5.2 操作预览

**请求**:
```http
POST /api/v1/batch-operations/preview
Content-Type: application/json

{
  "operationType": "assign",
  "entityType": "epic",
  "entityIds": ["epic-001", "epic-002"],
  "targetType": "version",
  "targetValue": "version-2025-q1"
}
```

**响应**:
```json
{
  "code": 200,
  "data": {
    "affectedEntities": {
      "features": 5,
      "pis": 2
    },
    "conflicts": [],
    "preview": {
      "before": [...],
      "after": [...]
    }
  }
}
```

---

## 六、集成位置

### 6.1 Epic列表页
- 批量分配到版本
- 批量变更状态
- 批量导出
- 批量删除

### 6.2 Feature列表页
- 批量分配到PI
- 批量变更优先级
- 批量评审
- 批量导出

### 6.3 SSTS列表页
- 批量分配到MR
- 批量变更状态
- 批量评审
- 批量导出

### 6.4 MR列表页
- 批量分配到Team
- 批量变更状态
- 批量评审
- 批量导出

### 6.5 Task列表页
- 批量分配到Sprint
- 批量变更负责人
- 批量估算工时
- 批量变更状态

### 6.6 Sprint列表页
- 批量变更状态
- 批量生成报告
- 批量导出

---

## 七、技术实现

### 7.1 组件设计

```vue
<BatchOperationCenter
  :entity-type="entityType"
  :selected-ids="selectedIds"
  :operations="availableOperations"
  @operation="handleBatchOperation"
/>
```

### 7.2 选择状态管理

- **本地状态**: 使用Vuex/Pinia管理选择状态
- **持久化**: 选择状态保存到localStorage
- **同步**: 多标签页选择状态同步

### 7.3 性能优化

- **虚拟滚动**: 大列表使用虚拟滚动
- **分批处理**: 大批量操作分批处理
- **进度显示**: 显示批量操作进度

---

**设计版本**: V1.0  
**最后更新**: 2026-01-17
