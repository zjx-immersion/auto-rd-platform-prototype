# UX-F04 智能通知系统

> **功能编号**: UX-F04  
> **功能名称**: 智能通知系统  
> **所属能力域**: 用户体验优化  
> **主要用户**: 全角色  
> **页面类型**: 通知中心 + 通知组件

---

## 一、功能概述

### 1.1 功能定位
智能通知系统主动推送关键信息，减少用户主动查找，提升信息及时性和协同效率。

### 1.2 核心价值
- **主动推送**: 减少60%信息查找时间
- **及时通知**: 提升关键信息及时性
- **智能过滤**: 根据重要性过滤通知
- **降低遗漏**: 降低关键信息遗漏风险

### 1.3 通知类型

| 通知类型 | 触发场景 | 优先级 | 通知方式 |
|---------|---------|--------|---------|
| 任务分配 | 任务分配给用户 | 高 | 站内通知 + 邮件 |
| 评审请求 | 需要用户评审 | 高 | 站内通知 + 邮件 |
| 状态变更 | 关注实体状态变更 | 中 | 站内通知 |
| 评论/提及 | 用户被@提及 | 中 | 站内通知 + 邮件 |
| 风险预警 | 识别到风险 | 高 | 站内通知 + 邮件 |
| 截止日期提醒 | 任务/评审即将到期 | 高 | 站内通知 + 邮件 |
| 流程推进 | 流程节点完成 | 低 | 站内通知 |

---

## 二、页面布局

### 2.1 通知中心页面

```
┌─────────────────────────────────────────────────────────────┐
│ 通知中心                                                    │
├─────────────────────────────────────────────────────────────┤
│ [全部] [未读] [任务] [评审] [风险] [设置] [全部标记已读]   │
├─────────────────────────────────────────────────────────────┤
│ 通知列表                                                    │
│ ┌─────────────────────────────────────────────────────────┐│
│ │ 🔴 [未读] 任务分配                                       ││
│ │ 👤 系统 分配了任务 TASK-001 给你                        ││
│ │ "实现自适应巡航功能"                                     ││
│ │ 2小时前  [查看任务] [标记已读]                          ││
│ │ ─────────────────────────────────────────────────────── ││
│ │                                                         ││
│ │ 🔴 [未读] 评审请求                                       ││
│ │ 👤 张伟 请求你评审 Feature ADAS-F001                   ││
│ │ "车道保持辅助（LKA）"                                   ││
│ │ 截止时间: 2026-01-20                                    ││
│ │ 5小时前  [查看评审] [标记已读]                          ││
│ │ ─────────────────────────────────────────────────────── ││
│ │                                                         ││
│ │ ⚪ [已读] 状态变更                                       ││
│ │ Feature ADAS-F001 状态变更为"进行中"                    ││
│ │ 1天前  [查看详情] [删除]                                ││
│ │ ─────────────────────────────────────────────────────── ││
│ │                                                         ││
│ │ 🔴 [未读] @提及                                         ││
│ │ 👤 李娜 在 Epic ADAS-E001 的评论中提到了你              ││
│ │ "这个Epic需要你的意见 @你"                              ││
│ │ 2天前  [查看评论] [标记已读]                            ││
│ │ ─────────────────────────────────────────────────────── ││
│ │                                                         ││
│ │ 🔴 [未读] 风险预警                                       ││
│ │ ⚠️ PI-2025-Q1 进度延迟5%，存在延期风险                  ││
│ │ 影响范围: 3个Feature, 2个Sprint                        ││
│ │ 3天前  [查看详情] [标记已读]                            ││
│ └─────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────┘
```

### 2.2 通知设置页面

```
┌─────────────────────────────────────────────────────────────┐
│ 通知设置                                                    │
├─────────────────────────────────────────────────────────────┤
│ 通知偏好设置                                                │
│ ┌─────────────────────────────────────────────────────────┐│
│ │ 通知类型          站内通知  邮件通知  推送通知          ││
│ │ ─────────────────────────────────────────────────────── ││
│ │ 任务分配          ☑        ☑        ☑                  ││
│ │ 评审请求          ☑        ☑        ☑                  ││
│ │ 状态变更          ☑        ☐        ☐                  ││
│ │ 评论/提及         ☑        ☑        ☐                  ││
│ │ 风险预警          ☑        ☑        ☑                  ││
│ │ 截止日期提醒      ☑        ☑        ☑                  ││
│ │ 流程推进          ☑        ☐        ☐                  ││
│ └─────────────────────────────────────────────────────────┘│
│                                                             │
│ 通知时间设置                                                │
│ ┌─────────────────────────────────────────────────────────┐│
│ │ 工作时间: 09:00 - 18:00                                 ││
│ │ 免打扰时间: 22:00 - 08:00                               ││
│ │ 周末通知: ☐ 关闭                                        ││
│ └─────────────────────────────────────────────────────────┘│
│                                                             │
│ [保存设置]                                                  │
└─────────────────────────────────────────────────────────────┘
```

---

## 三、数据字段

### 3.1 通知字段

| 字段名 | 字段类型 | 说明 |
|--------|---------|------|
| id | String | 通知ID |
| type | Enum | 通知类型 |
| title | String | 通知标题 |
| content | String | 通知内容 |
| entityType | Enum | 实体类型 |
| entityId | String | 实体ID |
| sender | User | 发送者 |
| receiver | User | 接收者 |
| priority | Enum | 优先级: high/medium/low |
| read | Boolean | 是否已读 |
| readAt | DateTime | 已读时间 |
| actionUrl | String | 操作链接 |
| createdAt | DateTime | 创建时间 |
| expiresAt | DateTime | 过期时间（可选） |

### 3.2 通知设置字段

| 字段名 | 字段类型 | 说明 |
|--------|---------|------|
| userId | String | 用户ID |
| notificationPreferences | Object | 通知偏好设置 |
| workingHours | Object | 工作时间设置 |
| quietHours | Object | 免打扰时间设置 |
| weekendNotification | Boolean | 周末是否通知 |

---

## 四、交互设计

### 4.1 通知显示

- **顶部通知图标**: 显示未读通知数量（红点）
- **通知下拉**: 点击图标显示最近通知列表
- **通知中心**: 完整通知列表和管理
- **桌面通知**: 浏览器桌面通知（需授权）

### 4.2 通知操作

- **查看详情**: 点击通知跳转到相关页面
- **标记已读**: 标记单个或批量标记已读
- **删除通知**: 删除不需要的通知
- **通知设置**: 自定义通知偏好

### 4.3 智能过滤

- **按类型过滤**: 任务、评审、风险等
- **按状态过滤**: 未读、已读
- **按时间过滤**: 今天、本周、本月
- **按优先级过滤**: 高、中、低

### 4.4 通知聚合

- **相同类型聚合**: 相同类型的通知聚合显示
- **批量操作**: 支持批量标记已读、批量删除
- **通知摘要**: 显示通知摘要和数量

---

## 五、API接口

### 5.1 获取通知列表

**请求**:
```http
GET /api/v1/notifications?type=&read=&page=1&pageSize=20
```

**响应**:
```json
{
  "code": 200,
  "data": {
    "notifications": [
      {
        "id": "notif-001",
        "type": "task-assignment",
        "title": "任务分配",
        "content": "系统 分配了任务 TASK-001 给你",
        "entityType": "task",
        "entityId": "task-001",
        "sender": {
          "id": "system",
          "name": "系统"
        },
        "priority": "high",
        "read": false,
        "actionUrl": "/function/c4-iteration/task/task-001",
        "createdAt": "2026-01-17T10:00:00Z"
      }
    ],
    "total": 15,
    "unreadCount": 5,
    "page": 1,
    "pageSize": 20
  }
}
```

### 5.2 标记通知已读

**请求**:
```http
PATCH /api/v1/notifications/{notificationId}/read
```

### 5.3 批量标记已读

**请求**:
```http
PATCH /api/v1/notifications/read-all
Content-Type: application/json

{
  "notificationIds": ["notif-001", "notif-002"]
}
```

### 5.4 获取通知设置

**请求**:
```http
GET /api/v1/notifications/settings
```

### 5.5 更新通知设置

**请求**:
```http
PUT /api/v1/notifications/settings
Content-Type: application/json

{
  "notificationPreferences": {
    "taskAssignment": {
      "inApp": true,
      "email": true,
      "push": true
    }
  },
  "workingHours": {
    "start": "09:00",
    "end": "18:00"
  }
}
```

---

## 六、集成位置

### 6.1 顶部导航栏
- 通知图标（显示未读数量）
- 通知下拉列表
- 跳转到通知中心

### 6.2 通知中心页面
- 完整通知列表
- 通知筛选和搜索
- 通知设置

### 6.3 工作台
- 通知Widget
- 最近通知列表
- 未读通知统计

### 6.4 详情页
- 相关通知显示
- 通知快捷操作

---

## 七、技术实现

### 7.1 通知推送机制

- **实时推送**: WebSocket实时推送通知
- **轮询机制**: 定时轮询获取新通知（备用）
- **离线支持**: 离线时缓存通知，上线后同步

### 7.2 通知聚合策略

- **时间窗口**: 5分钟内相同类型通知聚合
- **数量限制**: 最多聚合10条通知
- **优先级**: 高优先级通知不聚合

### 7.3 性能优化

- **分页加载**: 通知列表分页加载
- **虚拟滚动**: 大列表使用虚拟滚动
- **缓存策略**: 通知数据缓存5分钟

---

**设计版本**: V1.0  
**最后更新**: 2026-01-17
